<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>After Fitting • JointAI</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="After Fitting">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127879026-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127879026-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JointAI</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.0.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AfterFitting.html">After Fitting</a>
    </li>
    <li>
      <a href="../articles/MCMCsettings.html">MCMC Settings</a>
    </li>
    <li>
      <a href="../articles/MinimalExample.html">Minimal Example</a>
    </li>
    <li>
      <a href="../articles/ModelSpecification.html">Model Specification</a>
    </li>
    <li>
      <a href="../articles/SelectingParameters.html">Parameter Selection</a>
    </li>
    <li>
      <a href="../articles/TheoreticalBackground.html">Theoretical Background</a>
    </li>
    <li>
      <a href="../articles/VisualizingIncompleteData.html">Visualizing Incomplete Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nerler/JointAI/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
<li>
  <a href="https://twitter.com/N_Erler" class="external-link">
    <span class="fa fa-twitter fa-lg"></span>

  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>

    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>After Fitting</h1>
            <h3 data-toc-skip class="subtitle">Summary, visualization
and evaluation of the results</h3>
            
            <h4 data-toc-skip class="date">2020-06-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nerler/JointAI/blob/master/vignettes/AfterFitting.Rmd" class="external-link"><code>vignettes/AfterFitting.Rmd</code></a></small>
      <div class="hidden name"><code>AfterFitting.Rmd</code></div>

    </div>

    
    
<p>This vignette describes how the results from a <code>JointAI</code>
model can be visualized, summarized and evaluated. We use the <a href="https://nerler.github.io/JointAI/reference/NHANES.html">NHANES</a>
data for examples in cross-sectional data and the dataset <a href="https://nerler.github.io/JointAI/reference/simLong.html">simLong</a>
for examples in longitudinal data. For more info on these datasets,
check out the vignette <a href="https://nerler.github.io/JointAI/articles/VisualizingIncompleteData.html"><em>Visualizing
Incomplete Data</em></a>, in which the distributions of variables and
missing values in both sets is explored.</p>
<p>The functions described in this section use, by default, the full
MCMC sample and show only the parameters of the analysis model. A number
of arguments are available to select a subset of the MCMC samples that
is used to calculate the summary. The argument <code>subset</code>
allows controlling which part of the MCMC sample is returned and follows
the same logic as the argument <a href="https://nerler.github.io/JointAI/articles/SelectingParameters.html"><code>monitor_params</code></a>
in <a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>*_imp()</code></a>.
The use of these arguments is further explained <a href="#sec:subset">below</a>.</p>
<div class="section level2">
<h2 id="visualizing-the-posterior-sample">Visualizing the posterior sample<a class="anchor" aria-label="anchor" href="#visualizing-the-posterior-sample"></a>
</h2>
<p>The posterior sample can be visualized by two commonly used plots: a
trace plot, showing samples across iterations, or a plot of the
empirical density of the posterior sample.</p>
<div class="section level3">
<h3 id="trace-plot">Trace plot<a class="anchor" aria-label="anchor" href="#trace-plot"></a>
</h3>
<p>A trace plot shows the sampled values per chain and node throughout
iterations. It allows us to evaluate convergence and mixing of the
chains visually, and can be obtained with the function <a href="https://nerler.github.io/JointAI/reference/traceplot.html"><code>traceplot()</code></a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod13a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span><span class="op">(</span><span class="va">SBP</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">WC</span> <span class="op">+</span> <span class="va">alc</span> <span class="op">+</span> <span class="va">creat</span>, data <span class="op">=</span> <span class="va">NHANES</span>, n.iter <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                 seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" width="100%" style="display: block; margin: auto;"></p>
<p>When the sampler has converged the chains show one horizontal band,
as in the above figure. Consequently, when traces show a trend
convergence has not been reached and more iterations are necessary
(e.g., using <a href="https://nerler.github.io/JointAI/reference/add_samples.html"><code>add_samples()</code></a>).</p>
<p>Graphical aspects of the traceplot can be controlled by specifying
standard graphical arguments via the dots argument <code>"..."</code>,
which are passed to <a href="https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/matplot.html" class="external-link"><code>matplot()</code></a>.
This allows changing colour, line type and -width, limits, and so forth.
Arguments <code>nrow</code> and/or <code>ncol</code> can be supplied to
set specific numbers of rows and columns for the layout of the grid of
plots.</p>
<p>With the argument <code>use_ggplot</code> it is possible to get a <a href="https://CRAN.R-project.org/package=ggplot2" class="external-link"><strong>ggplot2</strong></a>
version of the traceplot. It can be extended using standard
<strong>ggplot2</strong> syntax.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod13a</span>, ncol <span class="op">=</span> <span class="fl">3</span>, use_ggplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'Dark2'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/ggtrace15a-1.png" alt="plot of chunk ggtrace15a" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="density-plot">Density plot<a class="anchor" aria-label="anchor" href="#density-plot"></a>
</h3>
<p>The posterior distributions can also be visualized using the function
<a href="https://nerler.github.io/JointAI/reference/densplot.html"><code>densplot()</code></a>,
which plots the empirical density per node per chain, or combining
chains (when <code>joined = TRUE</code>).</p>
<p>The argument <code>vlines</code> takes a list of lists, containing
specifications passed to <code>abline</code>, and allows us to add
(vertical) lines to the plot, e.g., marking zero:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod13a</span>, ncol <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkred"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>         vlines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">$</span><span class="va">SBP</span><span class="op">)</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" width="100%" style="display: block; margin: auto;">
or marking the posterior mean and 2.5% and 97.5% quantiles:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">SBP</span><span class="op">$</span><span class="va">regcoef</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mean'</span>, <span class="st">'2.5%'</span>, <span class="st">'97.5%'</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">SBP</span><span class="op">$</span><span class="va">sigma</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mean'</span>, <span class="st">'2.5%'</span>, <span class="st">'97.5%'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod13a</span>, ncol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>         vlines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">res</span><span class="op">[</span>, <span class="st">'Mean'</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">res</span><span class="op">[</span>, <span class="st">"2.5%"</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">res</span><span class="op">[</span>, <span class="st">"97.5%"</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/densplot15a-1.png" alt="plot of chunk densplot15a" width="100%" style="display: block; margin: auto;"></p>
<p>Like with <code><a href="../reference/traceplot.html">traceplot()</a></code> it is possible to use the
<strong>ggplot2</strong> version of <code><a href="../reference/densplot.html">densplot()</a></code> when setting
<code>use_ggplot = TRUE</code>. Here, vertical lines can be added as
additional layers:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit the complete-case version of the model</span></span>
<span><span class="va">mod13a_cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">NHANES</span>, na.action <span class="op">=</span> <span class="va">na.omit</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># make a dataset containing the quantiles of the posterior sample and</span></span>
<span><span class="co"># confidence intervals from the complete case analysis:</span></span>
<span><span class="va">quantDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">SBP</span><span class="op">$</span><span class="va">regcoef</span><span class="op">)</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">'2.5%'</span>,</span>
<span>                            model <span class="op">=</span> <span class="st">'JointAI'</span>,</span>
<span>                            value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">SBP</span><span class="op">$</span><span class="va">regcoef</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2.5%'</span><span class="op">)</span><span class="op">]</span></span>
<span>                            <span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">SBP</span><span class="op">$</span><span class="va">regcoef</span><span class="op">)</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">'97.5%'</span>,</span>
<span>                            model <span class="op">=</span> <span class="st">'JointAI'</span>,</span>
<span>                            value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">$</span><span class="va">res</span><span class="op">$</span><span class="va">SBP</span><span class="op">$</span><span class="va">regcoef</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'97.5%'</span><span class="op">)</span><span class="op">]</span></span>
<span>                 <span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod13a_cc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">'2.5%'</span>,</span>
<span>                            model <span class="op">=</span> <span class="st">'cc'</span>,</span>
<span>                            value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">mod13a_cc</span><span class="op">)</span><span class="op">[</span>, <span class="st">'2.5 %'</span><span class="op">]</span></span>
<span>                 <span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod13a_cc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">'97.5%'</span>,</span>
<span>                            model <span class="op">=</span> <span class="st">'cc'</span>,</span>
<span>                            value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">mod13a_cc</span><span class="op">)</span><span class="op">[</span>, <span class="st">'97.5 %'</span><span class="op">]</span></span>
<span>                 <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ggplot version:</span></span>
<span><span class="va">p13a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod13a</span>, use_ggplot <span class="op">=</span> <span class="cn">TRUE</span>, joined <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># add vertical lines for the:</span></span>
<span><span class="co"># - confidence intervals from the complete case analysis</span></span>
<span><span class="co"># - quantiles of the posterior distribution</span></span>
<span><span class="va">p13a</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">quantDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">model</span><span class="op">)</span>,</span>
<span>             lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'CI from model: '</span>,</span>
<span>                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'JointAI'</span>, <span class="st">'cc'</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'blue'</span>, <span class="st">'red'</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'JointAI'</span>, <span class="st">'compl.case'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/ggdens15a-1.png" alt="plot of chunk ggdens15a" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="model-summary">Model Summary<a class="anchor" aria-label="anchor" href="#model-summary"></a>
</h2>
<p>A summary of the posterior distribution estimated in a
<code>JointAI</code> model can be obtained using the function
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
<p>The posterior summary consists of the mean, standard deviation and
quantiles (by default, the 2.5% and 97.5% quantiles) of the MCMC samples
from all chains combined. Moreover, the tail probability (see below),
Gelman-Rubin criterion (see <a href="#sec:grcrit">section below</a>) and
the ratio of the Monte Carlo error to the posterior standard deviation
(see <a href="#sec:mcerror">section below</a>) are given.</p>
<p>Additionally, some essential characteristics of the MCMC samples on
which the summary is based is given. This includes the range and number
of iterations (“Sample size per chain”), thinning interval, and number
of chains. Furthermore, the number of observations (number of rows in
the data) is given.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian linear model fitted with JointAI</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, </span></span>
<span><span class="co">#&gt;     n.iter = 500, seed = 2020)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary:</span></span>
<span><span class="co">#&gt;                Mean     SD  2.5%  97.5% tail-prob. GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; (Intercept)  81.077 9.6921 61.66 99.602      0.000   1.011 0.0258</span></span>
<span><span class="co">#&gt; genderfemale  0.368 2.6138 -4.74  5.594      0.871   0.999 0.0258</span></span>
<span><span class="co">#&gt; WC            0.306 0.0736  0.16  0.448      0.000   1.012 0.0259</span></span>
<span><span class="co">#&gt; alc&gt;=1        6.365 2.4692  1.38 10.897      0.016   1.006 0.0291</span></span>
<span><span class="co">#&gt; creat         7.747 7.5949 -7.19 22.496      0.299   1.003 0.0264</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary of residual std. deviation:</span></span>
<span><span class="co">#&gt;           Mean    SD 2.5% 97.5% GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; sigma_SBP 14.4 0.779   13    16    1.02 0.0278</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC settings:</span></span>
<span><span class="co">#&gt; Iterations = 101:600</span></span>
<span><span class="co">#&gt; Sample size per chain = 500 </span></span>
<span><span class="co">#&gt; Thinning interval = 1 </span></span>
<span><span class="co">#&gt; Number of chains = 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of observations: 186</span></span></code></pre></div>
<p>For mixed models, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> also returns the posterior
summary of the random effects covariance matrix <code>D</code> and the
number of groups. The argument <code>missinfo = TRUE</code> will add
information on the missing values in the variables involved in the
model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span><span class="va">mod13b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lme_imp</a></span><span class="op">(</span><span class="va">bmi</span> <span class="op">~</span> <span class="va">GESTBIR</span> <span class="op">+</span> <span class="va">ETHN</span> <span class="op">+</span> <span class="va">HEIGHT_M</span> <span class="op">+</span> <span class="fu"><a href="../reference/ns.html">ns</a></span><span class="op">(</span><span class="va">age</span>, df <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                  random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span>,</span>
<span>                  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">simLong</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">bmi</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  n.iter <span class="op">=</span> <span class="fl">500</span>, no_model <span class="op">=</span> <span class="st">'age'</span>, seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13b</span>, missinfo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian linear mixed model fitted with JointAI</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lme_imp(fixed = bmi ~ GESTBIR + ETHN + HEIGHT_M + ns(age, df = 3), </span></span>
<span><span class="co">#&gt;     data = subset(simLong, !is.na(bmi)), random = ~1 | ID, n.iter = 500, </span></span>
<span><span class="co">#&gt;     no_model = "age", seed = 2020)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary:</span></span>
<span><span class="co">#&gt;                       Mean      SD    2.5%   97.5% tail-prob. GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; (Intercept)      17.567738 2.30929 12.9758 21.9295      0.000    1.01 0.0271</span></span>
<span><span class="co">#&gt; GESTBIR          -0.049258 0.04749 -0.1427  0.0472      0.312    1.00 0.0258</span></span>
<span><span class="co">#&gt; ETHNother         0.022619 0.15328 -0.2763  0.3213      0.883    1.00 0.0269</span></span>
<span><span class="co">#&gt; HEIGHT_M          0.000925 0.00962 -0.0174  0.0195      0.936    1.02 0.0274</span></span>
<span><span class="co">#&gt; ns(age, df = 3)1 -0.245192 0.07574 -0.3947 -0.0950      0.000    1.00 0.0258</span></span>
<span><span class="co">#&gt; ns(age, df = 3)2  1.939673 0.11262  1.7100  2.1489      0.000    1.00 0.0258</span></span>
<span><span class="co">#&gt; ns(age, df = 3)3 -1.247972 0.05842 -1.3656 -1.1326      0.000    1.01 0.0258</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary of random effects covariance matrix:</span></span>
<span><span class="co">#&gt;                Mean     SD  2.5% 97.5% tail-prob. GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; D_bmi_ID[1,1] 0.696 0.0781 0.552 0.858               1.02 0.0278</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary of residual std. deviation:</span></span>
<span><span class="co">#&gt;            Mean     SD  2.5% 97.5% GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; sigma_bmi 0.684 0.0119 0.662 0.709       1 0.0269</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC settings:</span></span>
<span><span class="co">#&gt; Iterations = 101:600</span></span>
<span><span class="co">#&gt; Sample size per chain = 500 </span></span>
<span><span class="co">#&gt; Thinning interval = 1 </span></span>
<span><span class="co">#&gt; Number of chains = 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of observations: 1881 </span></span>
<span><span class="co">#&gt; Number of groups:</span></span>
<span><span class="co">#&gt;  - ID: 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number and proportion of complete cases:</span></span>
<span><span class="co">#&gt;         level    #   %</span></span>
<span><span class="co">#&gt; ID         ID  190  95</span></span>
<span><span class="co">#&gt; lvlone lvlone 1881 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number and proportion of missing values:</span></span>
<span><span class="co">#&gt;      level # NA % NA</span></span>
<span><span class="co">#&gt; bmi lvlone    0    0</span></span>
<span><span class="co">#&gt; age lvlone    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          level # NA % NA</span></span>
<span><span class="co">#&gt; GESTBIR     ID    0    0</span></span>
<span><span class="co">#&gt; ID          ID    0    0</span></span>
<span><span class="co">#&gt; HEIGHT_M    ID    4    2</span></span>
<span><span class="co">#&gt; ETHN        ID    6    3</span></span></code></pre></div>
<p>At the end of the summary output, a summary of the number and
proportion of missing values per variable is printed</p>
<div class="section level3">
<h3 id="tail-probability">Tail probability<a class="anchor" aria-label="anchor" href="#tail-probability"></a>
</h3>
<p>The tail probability, calculated as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>P</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>P</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo>&lt;</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">2\times\min\left\{Pr(\theta &gt; 0), Pr(\theta &lt; 0)\right\},</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
is the parameter of interest, is a measure of how likely the value 0 is
under the estimated posterior distribution. The figure visualizes three
examples of posterior distributions and the corresponding minimum of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Pr(\theta &gt; 0)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo>&lt;</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Pr(\theta &lt; 0)</annotation></semantics></math>
(shaded area):
<img src="figures_AfterFitting/tailprob-1.png" alt="plot of chunk tailprob" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="evaluation-criteria">Evaluation criteria<a class="anchor" aria-label="anchor" href="#evaluation-criteria"></a>
</h2>
<p>The convergence of the MCMC chains and precision of the posterior
sample can also be evaluated more formally. Implemented in
<strong>JointAI</strong> are the Gelman-Rubin criterion for
convergence<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and a comparison of the Monte Carlo Error
with the posterior standard deviation.</p>
<div class="section level3">
<h3 id="sec:grcrit">Gelman-Rubin criterion for convergence<a class="anchor" aria-label="anchor" href="#sec:grcrit"></a>
</h3>
<p>The Gelman-Rubin criterion evaluates convergence by comparing within
and between chain variability and, thus, requires at least two MCMC
chains to be calculated. It is implemented for <code>JointAI</code>
objects in the function <a href="https://nerler.github.io/JointAI/reference/GR_crit.html"><code>GR_crit()</code></a>,
which is based on the function <code>gelman.diag()</code> from the
package <a href="https://CRAN.R-project.org/package=coda" class="external-link"><strong>coda</strong></a>.
The upper limit of the confidence interval should not be much larger
than 1.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GR_crit.html">GR_crit</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span></span>
<span><span class="co">#&gt; Potential scale reduction factors:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              Point est. Upper C.I.</span></span>
<span><span class="co">#&gt; (Intercept)        1.01       1.02</span></span>
<span><span class="co">#&gt; genderfemale       1.00       1.01</span></span>
<span><span class="co">#&gt; WC                 1.00       1.01</span></span>
<span><span class="co">#&gt; alc&gt;=1             1.00       1.01</span></span>
<span><span class="co">#&gt; creat              1.00       1.00</span></span>
<span><span class="co">#&gt; sigma_SBP          1.02       1.05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate psrf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1.01</span></span></code></pre></div>
<p>Besides the arguments <code>start</code>, <code>end</code>,
<code>thin</code>, and <code>subset</code>, which are explained <a href="#sec:subset">below</a>, <code><a href="../reference/GR_crit.html">GR_crit()</a></code> also takes the
arguments of <code>gelman.diag()</code>.</p>
</div>
<div class="section level3">
<h3 id="sec:mcerror">Monte Carlo Error<a class="anchor" aria-label="anchor" href="#sec:mcerror"></a>
</h3>
<p>The precision of the MCMC sample can be checked with the function <a href="https://nerler.github.io/JointAI/reference/MC_error.html"><code>MC_error()</code></a>.
It uses the function <code>mcmcse::mcmcse.mat()</code> from the package
<a href="https://CRAN.R-project.org/package=mcmcse" class="external-link"><strong>mcmcse</strong></a>
to calculate the Monte Carlo error (the error that is made since the
sample is finite) and compares it to the standard deviation of the
posterior sample. A rule of thumb is that the Monte Carlo error should
not be more than 5% of the standard deviation<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. Besides the arguments
explained <a href="#sec:subset">below</a>, <code><a href="../reference/MC_error.html">MC_error()</a></code> takes
the arguments of <code>mcmcse.mat()</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/MC_error.html">MC_error</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span></span>
<span><span class="co">#&gt;                est   MCSE    SD MCSE/SD</span></span>
<span><span class="co">#&gt; (Intercept)  81.08 0.2502 9.692   0.026</span></span>
<span><span class="co">#&gt; genderfemale  0.37 0.0675 2.614   0.026</span></span>
<span><span class="co">#&gt; WC            0.31 0.0019 0.074   0.026</span></span>
<span><span class="co">#&gt; alc&gt;=1        6.37 0.0718 2.469   0.029</span></span>
<span><span class="co">#&gt; creat         7.75 0.2007 7.595   0.026</span></span>
<span><span class="co">#&gt; sigma_SBP    14.40 0.0217 0.779   0.028</span></span></code></pre></div>
<p><code><a href="../reference/MC_error.html">MC_error()</a></code> returns an object of class
<code>MCElist</code>, which is a list containing matrices with the
posterior mean, estimated Monte Carlo error, posterior standard
deviation and the ratio of the Monte Carlo error to the posterior
standard deviation, for the scaled (if they are part of the
<code>JointAI</code> object) and unscaled (transformed back to the scale
of the data) posterior samples. The associated print method prints only
the latter.</p>
<p>To facilitate quick evaluation of the Monte Carlo error to posterior
standard deviation ratio, plotting of an object of class
<code>MCElist</code> using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> shows this ratio for each
(selected) node and automatically adds a vertical line at the desired
cut-off (by default 5%).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.6</span>, <span class="fl">0</span><span class="op">)</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/MC_error.html">MC_error</a></span><span class="op">(</span><span class="va">mod13a</span><span class="op">)</span><span class="op">)</span>  <span class="co"># left panel: all iterations 101:600</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/MC_error.html">MC_error</a></span><span class="op">(</span><span class="va">mod13a</span>, end <span class="op">=</span> <span class="fl">250</span><span class="op">)</span><span class="op">)</span>  <span class="co"># right panel: iterations 101:250</span></span></code></pre></div>
<p><img src="figures_AfterFitting/MCE15a-1.png" alt="plot of chunk MCE15a" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="sec:subset">Subset of output<a class="anchor" aria-label="anchor" href="#sec:subset"></a>
</h2>
<p>By default, the functions <code><a href="../reference/traceplot.html">traceplot()</a></code>,
<code><a href="../reference/densplot.html">densplot()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, <code><a href="../reference/GR_crit.html">GR_crit()</a></code>,
<code>MC_Error()</code> and <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> use all iterations of
the MCMC sample and consider only the parameters of the analysis model
(if they were monitored). In this section, we describe how the set of
iterations and parameters to display can be changed using the arguments
<code>subset</code>, <code>start</code>, <code>end</code>,
<code>thin</code> and <code>exclude_chains</code>.</p>
<div class="section level3">
<h3 id="subset-of-parameters">Subset of parameters<a class="anchor" aria-label="anchor" href="#subset-of-parameters"></a>
</h3>
<p>As long as the main parameters have been monitored in a
<code>JointAI</code> object, only these parameters are returned in the
model summary, plots and criteria shown above. When the main parameters
of the analysis model were not monitored, i.e.,
<code>monitor_params = c(analysis_main = FALSE)</code>, and the argument
<code>subset</code> is not specified, all parameters that were monitored
are displayed.</p>
<p>To display output for nodes other than the main parameters of the
analysis model or for a subset of nodes, the argument
<code>subset</code> needs to be specified.</p>
<div class="section level4">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h4>
<p>To display only the parameters of the imputation models, we set
<code>subset = c(analysis_main = FALSE, other_models = TRUE)</code>
(after re-estimating the model with the monitor for these parameters
switched on):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod13c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">mod13a</span>, monitor_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>other_models <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod13c</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>analysis_main <span class="op">=</span> <span class="cn">FALSE</span>, other_models <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bayesian joint model fitted with JointAI </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, </span></span>
<span><span class="co">#&gt;     n.iter = 500, monitor_params = c(other_models = TRUE), seed = 2020)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # --------------------------------------------------------------------- #</span></span>
<span><span class="co">#&gt;   Bayesian binomial model for "alc"</span></span>
<span><span class="co">#&gt; # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary:</span></span>
<span><span class="co">#&gt;                  Mean     SD    2.5%   97.5% tail-prob. GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; (Intercept)   0.51390 1.5325 -2.6068  3.4078     0.7080    1.01 0.0535</span></span>
<span><span class="co">#&gt; genderfemale -0.88236 0.3995 -1.6322 -0.0498     0.0373    1.04 0.0762</span></span>
<span><span class="co">#&gt; WC            0.00632 0.0115 -0.0169  0.0298     0.5627    1.01 0.0375</span></span>
<span><span class="co">#&gt; creat        -1.48151 1.2238 -3.9056  0.9785     0.2213    1.00 0.0603</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # --------------------------------------------------------------------- #</span></span>
<span><span class="co">#&gt;   Bayesian linear model for "creat"</span></span>
<span><span class="co">#&gt; # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary:</span></span>
<span><span class="co">#&gt;                   Mean       SD      2.5%    97.5% tail-prob. GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; (Intercept)   0.844704 0.076409  0.694938  0.99127      0.000       1 0.0258</span></span>
<span><span class="co">#&gt; genderfemale -0.178815 0.022122 -0.223627 -0.13699      0.000       1 0.0258</span></span>
<span><span class="co">#&gt; WC            0.000877 0.000772 -0.000612  0.00243      0.256       1 0.0258</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary of residual std. deviation:</span></span>
<span><span class="co">#&gt;              Mean      SD  2.5% 97.5% GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; sigma_creat 0.145 0.00769 0.132 0.161    1.01 0.0277</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # --------------------------------------------------------------------- #</span></span>
<span><span class="co">#&gt;   Bayesian linear model for "WC"</span></span>
<span><span class="co">#&gt; # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary:</span></span>
<span><span class="co">#&gt;               Mean   SD  2.5%   97.5% tail-prob. GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; (Intercept)  97.41 1.52 94.48 100.469     0.0000    1.00 0.0258</span></span>
<span><span class="co">#&gt; genderfemale -5.16 2.21 -9.38  -0.971     0.0147    1.01 0.0258</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Posterior summary of residual std. deviation:</span></span>
<span><span class="co">#&gt;          Mean    SD 2.5% 97.5% GR-crit MCE/SD</span></span>
<span><span class="co">#&gt; sigma_WC 14.5 0.785 13.2  16.3       1 0.0258</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # ----------------------------------------------------------- #</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC settings:</span></span>
<span><span class="co">#&gt; Iterations = 101:600</span></span>
<span><span class="co">#&gt; Sample size per chain = 500 </span></span>
<span><span class="co">#&gt; Thinning interval = 1 </span></span>
<span><span class="co">#&gt; Number of chains = 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of observations: 186</span></span></code></pre></div>
<p>To select only some of the parameters, they can be specified directly
by name via the <code>other</code> element of <code>subset</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod13c</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>analysis_main <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                               other <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'beta[4]'</span>, <span class="st">'beta[5]'</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" style="display: block; margin: auto;"></p>
<p>This also works when a subset of the imputed values should be
displayed:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># re-fit the model and monitor the imputed values</span></span>
<span><span class="va">mod13d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">mod13a</span>, monitor_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>imps <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select all imputed values for 'WC' (4th column of M_lvlone)</span></span>
<span><span class="va">sub3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'M_lvlone\\[[[:digit:]]+,4\\]'</span>, <span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">mod13d</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sub3</span></span>
<span><span class="co">#&gt; [1] "M_lvlone[33,4]"  "M_lvlone[150,4]"</span></span>
<span></span>
<span><span class="co"># pass "sub3" to "subset" via "other", for example in a traceplot:</span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod13d</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>analysis_main <span class="op">=</span> <span class="cn">FALSE</span>, other <span class="op">=</span> <span class="va">sub3</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/trace15d-1.png" alt="plot of chunk trace15d" style="display: block; margin: auto;"></p>
<p>When the number of imputed values is large or in order to check
convergence of random effects, it may not be feasible to plot and
inspect all trace plots. In that case a random subset of, for instance
the random effects, can be selected (output not shown):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># re-fit the model monitoring the random effects</span></span>
<span><span class="va">mod13e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">mod13b</span>, monitor_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ranef_main <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract random intercepts</span></span>
<span><span class="va">ri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'^b_bmi_ID\\[[[:digit:]]+,1\\]$'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod13e</span><span class="op">$</span><span class="va">MCMC</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to plot the chains of 12 randomly selected random intercepts and slopes:</span></span>
<span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod13e</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>analysis_main <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                other <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">ri</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="subset-of-mcmc-samples">Subset of MCMC samples<a class="anchor" aria-label="anchor" href="#subset-of-mcmc-samples"></a>
</h3>
<p>With the arguments <code>start</code>, <code>end</code> and
<code>thin</code> it is possible to select which iterations from the
MCMC sample are included in the summary. <code>start</code> and
<code>end</code> specify the first and last iterations to be used,
<code>thin</code> the thinning interval. Specification of
<code>start</code>, thus, allows discarding a “burn-in”, i.e., the
iterations before the MCMC chain had converged.</p>
<p>If a particular chain does not have converged it can be excluded from
the summary or plot using the argument <code>exclude_chains</code>. This
argument takes a numeric vector identifying chains to be excluded, for
example:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod14</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span><span class="op">(</span><span class="va">SBP</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">WC</span> <span class="op">+</span> <span class="va">alc</span> <span class="op">+</span> <span class="va">creat</span>, data <span class="op">=</span> <span class="va">NHANES</span>, n.iter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                progress.bar <span class="op">=</span> <span class="st">'none'</span>, n.chains <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod14</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod14</span>, exclude_chains <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-15-2.png" alt="plot of chunk unnamed-chunk-15" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod14</span>, thin <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod14</span>, start <span class="op">=</span> <span class="fl">150</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-16-2.png" alt="plot of chunk unnamed-chunk-16" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod14</span>, end <span class="op">=</span> <span class="fl">120</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-16-3.png" alt="plot of chunk unnamed-chunk-16" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="predicted-values">Predicted values<a class="anchor" aria-label="anchor" href="#predicted-values"></a>
</h2>
<p>Often, the aim of an analysis is not only to estimate the association
between outcome and covariates but to predict future outcomes or
outcomes for new subjects.</p>
<p>The function <a href="https://nerler.github.io/JointAI/reference/predict.JointAI.html"><code>predict()</code></a>
allows us to obtain predicted values and corresponding credible
intervals from <code>JointAI</code> objects. Note that for mixed models,
currently, only marginal prediction but not prediction conditional on
the random effects is implemented.</p>
<p>A dataset containing data which the prediction should be performed is
specified via the argument <code>newdata</code>. If no
<code>newdata</code> is given, the original data from the JointAI object
are used. The argument <code>quantiles</code> allows the specification
of the quantiles of the posterior sample that are used to obtain the
credible interval (by default the 2.5% and 97.5% quantile). Arguments
<code>start</code>, <code>end</code>, <code>thin</code> and
<code>exclude_chains</code> control the subset of MCMC samples that is
used.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod13a</span>, newdata <span class="op">=</span> <span class="va">NHANES</span><span class="op">[</span><span class="fl">27</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; $newdata</span></span>
<span><span class="co">#&gt;          SBP gender age             race   WC alc educ creat albu</span></span>
<span><span class="co">#&gt; 392 126.6667   male  32 Mexican American 94.1  &lt;1  low  0.83  4.2</span></span>
<span><span class="co">#&gt;     uricacid bili occup  smoke      fit     2.5%    97.5%</span></span>
<span><span class="co">#&gt; 392      8.7    1  &lt;NA&gt; former 116.3273 112.4343 120.1817</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fitted</span></span>
<span><span class="co">#&gt;        fit     2.5%    97.5%</span></span>
<span><span class="co">#&gt; 1 116.3273 112.4343 120.1817</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> returns a list with elements <code>dat</code>,
<code>fit</code> and <code>quantiles</code>, containing
<code>newdata</code> with the predicted values and quantiles appended,
the predicted values and quantiles that form the credible interval.</p>
<div class="section level3">
<h3 id="prediction-to-visualize-non-linear-effects">Prediction to visualize non-linear effects<a class="anchor" aria-label="anchor" href="#prediction-to-visualize-non-linear-effects"></a>
</h3>
<p>Another reason to obtain predicted values is the visualization of
non-linear effects, i.e., to create an effect plot. To facilitate the
generation of a dataset for such a prediction, the function <a href="https://nerler.github.io/JointAI/reference/predDF.html"><code>predDF()</code></a>
can be used. It generates a <code>data.frame</code> that contains a
sequence of values through the range of observed values for a covariate
specified by the argument <code>vars</code>, and the median or reference
value for all other continuous and categorical variables.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create dataset for prediction</span></span>
<span><span class="va">newDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predDF.html">predDF</a></span><span class="op">(</span><span class="va">mod13b</span>, var <span class="op">=</span> <span class="op">~</span> <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># obtain predicted values</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod13b</span>, newdata <span class="op">=</span> <span class="va">newDF</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: </span></span>
<span><span class="co">#&gt; Prediction in multi-level settings currently only takes into</span></span>
<span><span class="co">#&gt; account the fixed effects, i.e., assumes that the random</span></span>
<span><span class="co">#&gt; effect realizations are equal to zero.</span></span>
<span></span>
<span><span class="co"># plot predicted values and credible interval</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">newdata</span><span class="op">$</span><span class="va">age</span>, <span class="va">pred</span><span class="op">$</span><span class="va">fitted</span>,</span>
<span>        lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'l'</span>, col <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">'age in months'</span>, ylab <span class="op">=</span> <span class="st">'predicted value'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19" width="90%" style="display: block; margin: auto;"></p>
<p>It is possible to have multiple variables vary and to set values for
these variables:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create dataset for prediction</span></span>
<span><span class="va">newDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predDF.html">predDF</a></span><span class="op">(</span><span class="va">mod13b</span>, var <span class="op">=</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">HEIGHT_M</span> <span class="op">+</span> <span class="va">ETHN</span>, HEIGHT_M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># obtain predicted values</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod13b</span>, newdata <span class="op">=</span> <span class="va">newDF</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: </span></span>
<span><span class="co">#&gt; Prediction in multi-level settings currently only takes into</span></span>
<span><span class="co">#&gt; account the fixed effects, i.e., assumes that the random</span></span>
<span><span class="co">#&gt; effect realizations are equal to zero.</span></span>
<span></span>
<span></span>
<span><span class="co"># plot predicted values and credible interval</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">fit</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">HEIGHT_M</span><span class="op">)</span>,</span>
<span>                         fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">HEIGHT_M</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">`2.5%`</span>, ymax <span class="op">=</span> <span class="va">`97.5%`</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="st">'ETHN'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'maternal height'</span>,</span>
<span>                       aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'colour'</span>, <span class="st">'fill'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Expected BMI'</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-20-1.png" alt="plot of chunk unnamed-chunk-20" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="export-of-imputed-values">Export of imputed values<a class="anchor" aria-label="anchor" href="#export-of-imputed-values"></a>
</h2>
<p>Imputed datasets can be extracted from a <code>JointAI</code> object
(in which a monitor for the imputed values has been set, i.e.,
<code>monitor_params = c(imps = TRUE)</code>), with the function <a href="https://nerler.github.io/JointAI/reference/get_MIdat.html"><code>get_MIdat()</code></a>.</p>
<p>A completed dataset is created by taking the imputed values from a
randomly chosen iteration of the MCMC sample, transforming them back to
the original scale if scaling had been performed before the MCMC
sampling, and filling them into the original incomplete data.</p>
<p>The argument <code>m</code> specifies the number of imputed datasets
to be created, <code>include</code> controls whether the original data
are included in the long format <code>data.frame</code> (default is
<code>include = TRUE</code>), <code>start</code> specifies the first
iteration that may be used and <code>minspace</code> is the minimum
number of iterations between iterations eligible to be selected.</p>
<p>To make the selection of iterations to form the imputed data
reproducible, a seed value can be specified via the argument
<code>seed</code>.</p>
<p>When <code>export_to_SPSS = TRUE</code> the imputed data is exported
to SPSS, i.e., a <code>.txt</code> file containing the data and a
<code>.sps</code> file containing SPSS syntax to convert the data into
an SPSS data file (with ending <code>.sav</code>) are written. Arguments
<code>filename</code> and <code>resdir</code> allow the specification of
the name of the <code>.txt</code> and <code>.sps</code> file and the
directory they are written to.</p>
<p><code><a href="../reference/get_MIdat.html">get_MIdat()</a></code> returns a long-format
<code>data.frame</code> containing the imputed datasets (and by default
the original data) stacked onto each other. The imputation number is
given in the variable <code>Imputation_</code>, column <code>.id</code>
contains a newly created id variable for each observation in
cross-sectional data (multi-level data should already contain an id
variable).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">impDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_MIdat.html">get_MIdat</a></span><span class="op">(</span><span class="va">mod13d</span>, m <span class="op">=</span> <span class="fl">10</span>, seed <span class="op">=</span> <span class="fl">2018</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/plot_imp_distr.html">plot_imp_distr()</a></code> allows us to visually
compare the distribution of the observed and imputed values.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_imp_distr.html">plot_imp_distr</a></span><span class="op">(</span><span class="va">impDF</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures_AfterFitting/unnamed-chunk-22-1.png" alt="plot of chunk unnamed-chunk-22" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Gelman, A. and Rubin, D.B. (1992). Inference from
Iterative Simulation Using Multiple Sequences. <em>Statistical
Science</em> <strong>7</strong>(4), 457-472. doi: 10.1214/ss/1177011136.
<br><br> Brooks, S. P. and Gelman, A. (1998). General Methods for
Monitoring Convergence of Iterative Simulations. <em>Journal of
Computational and Graphical Statistics</em> <strong>7</strong>(4), 434 -
455. doi: 10.1080/10618600.1998.10474787.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Lesaffre, E. M. and A. B. Lawson (2012). <em>Bayesian
Biostatistics</em>. John Wiley &amp; Sons. doi: 10.1002/9781119942412.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicole S. Erler.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: '0d21d69e7c3eb00e029f5b8d9424cd56',
    indexName: 'jointal',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
