<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>After Fitting • JointAI</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="After Fitting">
<meta property="og:description" content="JointAI">
<meta property="og:image" content="https://nerler.github.io/JointAI/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127879026-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127879026-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JointAI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AfterFitting.html">After Fitting</a>
    </li>
    <li>
      <a href="../articles/MCMCsettings.html">MCMC Settings</a>
    </li>
    <li>
      <a href="../articles/MinimalExample.html">Minimal Example</a>
    </li>
    <li>
      <a href="../articles/ModelSpecification.html">Model Specification</a>
    </li>
    <li>
      <a href="../articles/SelectingParameters.html">Parameter Selection</a>
    </li>
    <li>
      <a href="../articles/TheoreticalBackground.html">Theoretical Background</a>
    </li>
    <li>
      <a href="../articles/VisualizingIncompleteData.html">Visualizing Incomplete Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nerler/JointAI/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/N_Erler">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>After Fitting</h1>
            <h3 class="subtitle">Summary, visualization and evaluation of the results</h3>
            
            <h4 class="date">2019-08-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nerler/JointAI/blob/master/vignettes/AfterFitting.Rmd"><code>vignettes/AfterFitting.Rmd</code></a></small>
      <div class="hidden name"><code>AfterFitting.Rmd</code></div>

    </div>

    
    
<p>This vignette describes how the results from a <code>JointAI</code> model can be visualized, summarized and evaluated. We use the <a href="https://nerler.github.io/JointAI/reference/NHANES.html">NHANES</a> data for examples in cross-sectional data and the dataset <a href="https://nerler.github.io/JointAI/reference/simLong.html">simLong</a> for examples in longitudinal data. For more info on these datasets, check out the vignette <a href="https://nerler.github.io/JointAI/articles/VisualizingIncompleteData.html"><em>Visualizing Incomplete Data</em></a>, in which the distributions of variables and missing values in both sets is explored.</p>
<p>The functions described in this section use, by default, the full MCMC sample and show only the parameters of the analysis model. A number of arguments are available to select a subset of the MCMC samples that is used to calculate the summary. The argument <code>subset</code> allows controlling which part of the MCMC sample is returned and follows the same logic as the argument <a href="https://nerler.github.io/JointAI/articles/SelectingParameters.html"><code>monitor_params</code></a> in <a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>*_imp()</code></a>. The use of these arguments is further explained <a href="#sec:subset">below</a>.</p>
<div id="visualizing-the-posterior-sample" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-the-posterior-sample" class="anchor"></a>Visualizing the posterior sample</h2>
<p>The posterior sample can be visualized by two commonly used plots: a traceplot, showing samples across iterations, or a plot of the empirical density of the posterior sample.</p>
<div id="traceplot" class="section level3">
<h3 class="hasAnchor">
<a href="#traceplot" class="anchor"></a>Traceplot</h3>
<p>A traceplot shows the sampled values per chain and node throughout iterations. It allows us to visually evaluate convergence and mixing of the chains, and can be obtained with the function <a href="https://nerler.github.io/JointAI/reference/traceplot.html"><code><a href="../reference/traceplot.html">traceplot()</a></code></a>:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">mod13a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span>(<span class="no">SBP</span> ~ <span class="no">gender</span> + <span class="no">WC</span> + <span class="no">alc</span> + <span class="no">creat</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>, <span class="kw">n.iter</span> <span class="kw">=</span> <span class="fl">500</span>)

<span class="fu"><a href="../reference/traceplot.html">traceplot</a></span>(<span class="no">mod13a</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-1-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>When the sampler has converged the chains show one horizontal band, as in the above figure. Consequently, when traces show a trend convergence has not been reached and more iterations are necessary (e.g., using <a href="https://nerler.github.io/JointAI/reference/add_samples.html"><code><a href="../reference/add_samples.html">add_samples()</a></code></a>).</p>
<p>Graphical aspects of the traceplot can be controlled by specifying standard graphical arguments via the dots argument <code>"..."</code>, which are passed to <a href="https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/matplot.html"><code><a href="https://rdrr.io/r/graphics/matplot.html">matplot()</a></code></a>. This allows changing color, linetype and -width, limits, etc. Arguments <code>nrow</code> and/or <code>ncol</code> can be supplied to set specific numbers of rows and columns for the layout of the grid of plots.</p>
<p>With the argument <code>use_ggplot</code> it is possible to get a <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> version of the traceplot. It can be extended using standard <strong>ggplot2</strong> syntax.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="../reference/traceplot.html">traceplot</a></span>(<span class="no">mod13a</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">use_ggplot</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'bottom'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">'Dark2'</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/ggtrace15a-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="density-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#density-plot" class="anchor"></a>Density plot</h3>
<p>The posterior distributions can also be visualized using the function <a href="https://nerler.github.io/JointAI/reference/densplot.html"><code><a href="../reference/densplot.html">densplot()</a></code></a>, which plots the empirical density per node per chain, or combining chains (when <code>joined = TRUE</code>).</p>
<p>The argument <code>vlines</code> takes a list of lists, containing specifications passed to <code>abline</code>, and allows us to add (vertical) lines to the plot, e.g., marking zero:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/densplot.html">densplot</a></span>(<span class="no">mod13a</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkred"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span>),
         <span class="kw">vlines</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">mod13a</span>)$<span class="no">SBP</span>)), <span class="fl">NA</span>),
                            <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="fl">0.8</span>))))</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"> or marking the posterior mean and 2.5% and 97.5% quantiles:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13a</span>)$<span class="no">res</span>$<span class="no">SBP</span>$<span class="no">regcoef</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Mean'</span>, <span class="st">'2.5%'</span>, <span class="st">'97.5%'</span>)],
             <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13a</span>)$<span class="no">res</span>$<span class="no">SBP</span>$<span class="no">sigma</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Mean'</span>, <span class="st">'2.5%'</span>, <span class="st">'97.5%'</span>)])

<span class="fu"><a href="../reference/densplot.html">densplot</a></span>(<span class="no">mod13a</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>,
         <span class="kw">vlines</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="no">res</span>[, <span class="st">'Mean'</span>], <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">1</span>,
                            <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>),
                       <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="no">res</span>[, <span class="st">"2.5%"</span>], <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>),
                       <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="no">res</span>[, <span class="st">"97.5%"</span>], <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)
         )
)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/densplot15a-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Like with <code><a href="../reference/traceplot.html">traceplot()</a></code> it is possible to use the <strong>ggplot2</strong> version of <code><a href="../reference/densplot.html">densplot()</a></code> when setting <code>use_ggplot = TRUE</code>. Here, vertical lines can be added as additional layers:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># fit the complete-case version of the model</span>
<span class="no">mod13a_cc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span>(<span class="no">mod13a</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>)


<span class="co"># make a dataset containing the quantiles of the posterior sample and</span>
<span class="co"># confidence intervals from the complete case analysis:</span>
<span class="no">quantDF</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">variable</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13a</span>)$<span class="no">res</span>$<span class="no">SBP</span>$<span class="no">regcoef</span>),
                            <span class="kw">type</span> <span class="kw">=</span> <span class="st">'2.5%'</span>,
                            <span class="kw">model</span> <span class="kw">=</span> <span class="st">'JointAI'</span>,
                            <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13a</span>)$<span class="no">res</span>$<span class="no">SBP</span>$<span class="no">regcoef</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'2.5%'</span>)]
                            ),
                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">variable</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13a</span>)$<span class="no">res</span>$<span class="no">SBP</span>$<span class="no">regcoef</span>),
                            <span class="kw">type</span> <span class="kw">=</span> <span class="st">'97.5%'</span>,
                            <span class="kw">model</span> <span class="kw">=</span> <span class="st">'JointAI'</span>,
                            <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13a</span>)$<span class="no">res</span>$<span class="no">SBP</span>$<span class="no">regcoef</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'97.5%'</span>)]
                 ),
                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">variable</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">mod13a_cc</span>)),
                            <span class="kw">type</span> <span class="kw">=</span> <span class="st">'2.5%'</span>,
                            <span class="kw">model</span> <span class="kw">=</span> <span class="st">'cc'</span>,
                            <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(<span class="no">mod13a_cc</span>)[, <span class="st">'2.5 %'</span>]
                 ),
                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">variable</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">mod13a_cc</span>)),
                            <span class="kw">type</span> <span class="kw">=</span> <span class="st">'97.5%'</span>,
                            <span class="kw">model</span> <span class="kw">=</span> <span class="st">'cc'</span>,
                            <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(<span class="no">mod13a_cc</span>)[, <span class="st">'97.5 %'</span>]
                 )
)


<span class="co"># ggplot version:</span>
<span class="no">p13a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/densplot.html">densplot</a></span>(<span class="no">mod13a</span>, <span class="kw">use_ggplot</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">joined</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'bottom'</span>)


<span class="co"># add vertical lines for the:</span>
<span class="co"># - confidence intervals from the complete case analysis</span>
<span class="co"># - quantiles of the posterior distribution</span>
<span class="co"># p13a +</span>
  <span class="co"># geom_vline(data = quantDF, aes(xintercept = value, color = model),</span>
  <span class="co">#            lty = 2) +</span>
  <span class="co"># scale_color_manual(name = 'CI from model: ',</span>
                     <span class="co"># limits = c('JointAI', 'cc'),</span>
                     <span class="co"># values = c('blue', 'red'),</span>
                     <span class="co"># labels = c('JointAI', 'compl.case'))</span></pre></body></html></div>
</div>
</div>
<div id="model-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#model-summary" class="anchor"></a>Model Summary</h2>
<p>A summary of the posterior distribution estimated in a <code>JointAI</code> model can be obtained using the function <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>.</p>
<p>The posterior summary consists of the mean, standard deviation and quantiles (by default the 2.5% and 97.5% quantiles) of the MCMC samples from all chains combined, as well as the tail probability (see below) and Gelman-Rubin criterion (see <a href="#sec:grcrit">section below</a>).</p>
<p>Additionally, some important characteristics of the MCMC samples on which the summary is based is given. This includes the range and number of iterations (“Sample size per chain”), thinning interval and number of chains. Furthermore, the number of observations (number of rows in the data) is given.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13a</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Linear model fitted with JointAI</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, </span>
<span class="co">#&gt;     n.iter = 500)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary:</span>
<span class="co">#&gt;                Mean      SD   2.5%   97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; (Intercept)  81.286 10.0392 61.601 100.065     0.0000   1.003   0.0271</span>
<span class="co">#&gt; genderfemale  0.343  2.6281 -4.896   5.653     0.9120   1.003   0.0267</span>
<span class="co">#&gt; WC            0.305  0.0757  0.155   0.447     0.0000   0.999   0.0264</span>
<span class="co">#&gt; alc&gt;=1        6.283  2.4165  1.450  10.962     0.0107   1.000   0.0321</span>
<span class="co">#&gt; creat         7.688  7.8754 -7.739  23.267     0.3147   1.007   0.0187</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary of residual std. deviation:</span>
<span class="co">#&gt;           Mean    SD 2.5% 97.5% GR-crit MC error</span>
<span class="co">#&gt; sigma_SBP 14.4 0.768 13.1    16    1.01   0.0258</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MCMC settings:</span>
<span class="co">#&gt; Iterations = 101:600</span>
<span class="co">#&gt; Sample size per chain = 500 </span>
<span class="co">#&gt; Thinning interval = 1 </span>
<span class="co">#&gt; Number of chains = 3 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of observations: 186 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number and proportion of missing values:</span>
<span class="co">#&gt;        variable # NA  % NA</span>
<span class="co">#&gt; SBP         SBP    0  0.00</span>
<span class="co">#&gt; gender   gender    0  0.00</span>
<span class="co">#&gt; WC           WC    2  1.08</span>
<span class="co">#&gt; creat     creat    8  4.30</span>
<span class="co">#&gt; alc         alc   34 18.28</span></pre></body></html></div>
<p>For mixed models, <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> also returns the posterior summary of the random effects covariance matrix <code>D</code> and the number of groups:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">splines</span>)
<span class="no">mod13b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lme_imp</a></span>(<span class="no">bmi</span> ~ <span class="no">GESTBIR</span> + <span class="no">ETHN</span> + <span class="no">HEIGHT_M</span> + <span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span>(<span class="no">age</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="fl">3</span>),
                  <span class="kw">random</span> <span class="kw">=</span> ~ <span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span>(<span class="no">age</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">|</span> <span class="no">ID</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">simLong</span>, !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">bmi</span>)),
                  <span class="kw">n.iter</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">no_model</span> <span class="kw">=</span> <span class="st">'age'</span>, <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">2019</span>)

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13b</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Linear mixed model fitted with JointAI</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lme_imp(fixed = bmi ~ GESTBIR + ETHN + HEIGHT_M + ns(age, df = 3), </span>
<span class="co">#&gt;     data = subset(simLong, !is.na(bmi)), random = ~ns(age, df = 1) | </span>
<span class="co">#&gt;         ID, n.iter = 500, no_model = "age", seed = 2019)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary:</span>
<span class="co">#&gt;                     Mean     SD    2.5%   97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; (Intercept)       4.0068 9.3529 -16.724 17.5519     0.6160    4.90    0.440</span>
<span class="co">#&gt; GESTBIR           0.0345 0.2992  -0.409  0.6579     0.9920    6.93    0.892</span>
<span class="co">#&gt; ETHNother         0.2946 0.3196  -0.342  0.8735     0.3480    2.12    0.397</span>
<span class="co">#&gt; HEIGHT_M         -0.0232 0.0316  -0.076  0.0454     0.4880    4.39    0.378</span>
<span class="co">#&gt; ns(age, df = 3)1 -0.5756 0.3426  -1.115  0.1073     0.1240    1.55    0.385</span>
<span class="co">#&gt; ns(age, df = 3)2  1.2662 0.7114   0.198  2.7028     0.0147    1.55    0.422</span>
<span class="co">#&gt; ns(age, df = 3)3 -1.8211 0.6230  -2.756 -0.5797     0.0000    1.57    0.486</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary of random effects covariance matrix:</span>
<span class="co">#&gt;                  Mean      SD   2.5%   97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; D_bmi_ID[1,1] 158.672 39.5654 90.334 233.531               1.11    0.340</span>
<span class="co">#&gt; D_bmi_ID[1,2]   2.269  2.4878 -3.248   6.060      0.364    1.74    0.452</span>
<span class="co">#&gt; D_bmi_ID[2,2]   0.213  0.0875  0.112   0.413               1.43    0.237</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary of residual std. deviation:</span>
<span class="co">#&gt;           Mean     SD 2.5% 97.5% GR-crit MC error</span>
<span class="co">#&gt; sigma_bmi 0.57 0.0106 0.55 0.591       1   0.0356</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MCMC settings:</span>
<span class="co">#&gt; Iterations = 101:600</span>
<span class="co">#&gt; Sample size per chain = 500 </span>
<span class="co">#&gt; Thinning interval = 1 </span>
<span class="co">#&gt; Number of chains = 3 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of observations: 1881 </span>
<span class="co">#&gt; Number of groups:</span>
<span class="co">#&gt;  - ID: 200</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number and proportion of missing values:</span>
<span class="co">#&gt; $lvlone</span>
<span class="co">#&gt;     variable  level # NA % NA</span>
<span class="co">#&gt; bmi      bmi lvlone    0    0</span>
<span class="co">#&gt; age      age lvlone    0    0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ID</span>
<span class="co">#&gt;          variable level # NA % NA</span>
<span class="co">#&gt; GESTBIR   GESTBIR    ID    0    0</span>
<span class="co">#&gt; ID             ID    ID    0    0</span>
<span class="co">#&gt; HEIGHT_M HEIGHT_M    ID    4    2</span>
<span class="co">#&gt; ETHN         ETHN    ID    6    3</span></pre></body></html></div>
<div id="tail-probability" class="section level3">
<h3 class="hasAnchor">
<a href="#tail-probability" class="anchor"></a>Tail probability</h3>
<p>The tail probability, calculated as <span class="math inline">\(2\times\min\left\{Pr(\theta &gt; 0), Pr(\theta &lt; 0)\right\},\)</span> where <span class="math inline">\(\theta\)</span> is the parameter of interest, is a measure of how likely the value 0 is under the estimated posterior distribution. The figure visualizes three examples of posterior distributions and the corresponding minimum of <span class="math inline">\(Pr(\theta &gt; 0)\)</span> and <span class="math inline">\(Pr(\theta &lt; 0)\)</span> (shaded area): <img src="AfterFitting_files/figure-html/tailprob-1.png" width="100%" style="display: block; margin: auto;"></p>
<!-- By default, `summary()` will only print the posterior summary for the main -->
<!-- model parameters of the analysis model and use the whole MCMC sample. -->
<!-- The argument `subset` allows to control -->
<!-- which part of the MCMC sample is returned and follows the same logic as -->
<!-- the argument `monitor_params` in `*_imp()`. -->
<!-- Arguments `start`, `end` and `thin` are available to select a subset of the MCMC -->
<!-- samples that is used to calculate the summary. -->
<!-- The use of these arguments is further explained [below](#sec:subset)). -->
</div>
</div>
<div id="evaluation-criteria" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluation-criteria" class="anchor"></a>Evaluation criteria</h2>
<p>The convergence of the MCMC chains and precision of the posterior sample can also be evaluated more formally. Implemented in <strong>JointAI</strong> are the Gelman-Rubin criterion for convergence<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and a comparison of the Monte Carlo Error with the posterior standard deviation.</p>
<div id="sec:grcrit" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:grcrit" class="anchor"></a>Gelman-Rubin criterion for convergence</h3>
<p>The Gelman-Rubin criterion evaluates convergence by comparing within and between chain variability and, thus, requires at least two MCMC chains to be calculated. It is implemented for <code>JointAI</code> objects in the function <a href="https://nerler.github.io/JointAI/reference/GR_crit.html"><code><a href="../reference/GR_crit.html">GR_crit()</a></code></a>, which is based on the function <code>gelman.diag()</code> from the package <a href="https://CRAN.R-project.org/package=coda"><strong>coda</strong></a>. The upper limit of the confidence interval should not be much larger than 1.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/GR_crit.html">GR_crit</a></span>(<span class="no">mod13a</span>)
<span class="co">#&gt; Potential scale reduction factors:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Point est. Upper C.I.</span>
<span class="co">#&gt; (Intercept)       1.000       1.00</span>
<span class="co">#&gt; genderfemale      1.004       1.01</span>
<span class="co">#&gt; WC                0.999       1.00</span>
<span class="co">#&gt; alc&gt;=1            1.001       1.01</span>
<span class="co">#&gt; creat             1.001       1.00</span>
<span class="co">#&gt; sigma_SBP         1.008       1.03</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate psrf</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1.02</span></pre></body></html></div>
<p>Besides the arguments <code>start</code>, <code>end</code>, <code>thin</code>, and <code>subset</code>, which are explained <a href="#sec:subset">below</a>, <code><a href="../reference/GR_crit.html">GR_crit()</a></code> also takes the arguments of <code>gelman.diag()</code>.</p>
</div>
<div id="sec:mcerror" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:mcerror" class="anchor"></a>Monte Carlo Error</h3>
<p>The precision of the MCMC sample can be checked with the function <a href="https://nerler.github.io/JointAI/reference/MC_error.html"><code><a href="../reference/MC_error.html">MC_error()</a></code></a>. It uses the function <code>mcmcse.mat()</code> from the package <a href="https://CRAN.R-project.org/package=mcmcse"><strong>mcmcse</strong></a> to calculate the Monte Carlo error (the error that is made since the sample is finite) and compares it to the standard deviation of the posterior sample. A rule of thumb is that the Monte Carlo error should not be more than 5% of the standard deviation<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. Besides the arguments explained <a href="#sec:subset">below</a>, <code><a href="../reference/MC_error.html">MC_error()</a></code> takes the arguments of <code>mcmcse.mat()</code>.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/MC_error.html">MC_error</a></span>(<span class="no">mod13a</span>)
<span class="co">#&gt;                est  MCSE     SD MCSE/SD</span>
<span class="co">#&gt; (Intercept)  81.29 0.272 10.039   0.027</span>
<span class="co">#&gt; genderfemale  0.34 0.070  2.628   0.027</span>
<span class="co">#&gt; WC            0.31 0.002  0.076   0.026</span>
<span class="co">#&gt; alc&gt;=1        6.28 0.077  2.416   0.032</span>
<span class="co">#&gt; creat         7.69 0.147  7.875   0.019</span>
<span class="co">#&gt; sigma_SBP    14.43 0.020  0.768   0.026</span></pre></body></html></div>
<p><code><a href="../reference/MC_error.html">MC_error()</a></code> returns an object of class <code>MCElist</code>, which is a list containing matrices with the posterior mean, estimated Monte Carlo error, posterior standard deviation and the ratio of the Monte Carlo error to the posterior standard deviation, for the scaled (if they are part of the <code>JointAI</code> object) and unscaled (transformed back to the scale of the data) posterior samples. The associated print method prints only the latter.</p>
<p>To facilitate quick evaluation of the Monte Carlo error to posterior standard deviation ratio, plotting of an object of class <code>MCElist</code> using <code><a href="https://rdrr.io/r/base/plot.html">plot()</a></code> shows this ratio for each (selected) node and automatically adds a vertical line at the desired cut-off (by default 5%).</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="kw">mgp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">0.6</span>, <span class="fl">0</span>), <span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/MC_error.html">MC_error</a></span>(<span class="no">mod13a</span>))  <span class="co"># left panel: all iterations 101:600</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/MC_error.html">MC_error</a></span>(<span class="no">mod13a</span>, <span class="kw">end</span> <span class="kw">=</span> <span class="fl">250</span>))  <span class="co"># right panel: iterations 101:250</span></pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/MCE15a-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="sec:subset" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:subset" class="anchor"></a>Subset of output</h2>
<p>By default, the functions <code><a href="../reference/traceplot.html">traceplot()</a></code>, <code><a href="../reference/densplot.html">densplot()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, <code><a href="../reference/GR_crit.html">GR_crit()</a></code>, <code>MC_Error()</code> and <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> use all iterations of the MCMC sample and consider only the parameters of the analysis model (if they were monitored). In this section, we describe how the set of iterations and parameters to display can be changed using the arguments <code>subset</code>, <code>start</code>, <code>end</code>, <code>thin</code> and <code>exclude_chains</code>.</p>
<div id="subset-of-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#subset-of-parameters" class="anchor"></a>Subset of parameters</h3>
<p>As long as the main parameters have been monitored in a <code>JointAI</code> object, only these parameters are returned in the model summary, plots and criteria shown above. When the main parameters of the analysis model were not monitored, i.e., <code>monitor_params = c(analysis_main = FALSE)</code>, and the argument <code>subset</code> is not specified, all parameters that were monitored are displayed.</p>
<p>To display output for nodes other than the main parameters of the analysis model or for a subset of nodes, the argument <code>subset</code> needs to be specified.</p>
<div id="examples" class="section level4">
<h4 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h4>
<p>To display only the parameters of the imputation models, we set <code>subset = c(analysis_main = FALSE, imp_pars = TRUE)</code> (after re-estimating the model with the monitor for these parameters switched on):</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">mod13c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="no">mod13a</span>, <span class="kw">monitor_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">imp_pars</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod13c</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">analysis_main</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">imp_pars</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="co">#&gt; </span>
<span class="co">#&gt; Bayesian joint model fitted with JointAI </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, </span>
<span class="co">#&gt;     n.iter = 500, monitor_params = c(imp_pars = TRUE))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # --------------------------------------------------------------------- #</span>
<span class="co">#&gt;   Binomial model for "alc"</span>
<span class="co">#&gt; # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary:</span>
<span class="co">#&gt;                  Mean     SD    2.5%   97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; (Intercept)   0.71210 1.6342 -2.5771  3.9092     0.6387    1.06   0.0663</span>
<span class="co">#&gt; genderfemale -0.96090 0.4410 -1.8534 -0.1296     0.0293    1.05   0.0851</span>
<span class="co">#&gt; WC            0.00602 0.0118 -0.0171  0.0287     0.6160    1.05   0.0369</span>
<span class="co">#&gt; creat        -1.64067 1.2787 -4.1253  0.8589     0.2067    1.03   0.0680</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # --------------------------------------------------------------------- #</span>
<span class="co">#&gt;   Linear model for "creat"</span>
<span class="co">#&gt; # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary:</span>
<span class="co">#&gt;                   Mean       SD      2.5%    97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; (Intercept)   0.838101 0.073961  0.693031  0.98387      0.000   1.000   0.0258</span>
<span class="co">#&gt; genderfemale -0.177016 0.021606 -0.218519 -0.13499      0.000   1.001   0.0260</span>
<span class="co">#&gt; WC            0.000948 0.000753 -0.000503  0.00241      0.209   0.999   0.0258</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary of other parameters:</span>
<span class="co">#&gt;           Mean   SD 2.5% 97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; tau_creat 47.5 4.97 38.1  57.7          0       1   0.0258</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # --------------------------------------------------------------------- #</span>
<span class="co">#&gt;   Linear model for "WC"</span>
<span class="co">#&gt; # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary:</span>
<span class="co">#&gt;               Mean   SD  2.5%  97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; (Intercept)  97.47 1.42 94.81 100.30      0.000    1.01   0.0258</span>
<span class="co">#&gt; genderfemale -5.28 2.11 -9.45  -1.38      0.008    1.00   0.0258</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Posterior summary of other parameters:</span>
<span class="co">#&gt;          Mean       SD    2.5%   97.5% tail-prob. GR-crit MC error</span>
<span class="co">#&gt; tau_WC 0.0048 0.000519 0.00385 0.00589          0       1   0.0265</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # ----------------------------------------------------------- #</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MCMC settings:</span>
<span class="co">#&gt; Iterations = 101:600</span>
<span class="co">#&gt; Sample size per chain = 500 </span>
<span class="co">#&gt; Thinning interval = 1 </span>
<span class="co">#&gt; Number of chains = 3 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of observations: 186 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number and proportion of missing values:</span>
<span class="co">#&gt;        variable # NA  % NA</span>
<span class="co">#&gt; SBP         SBP    0  0.00</span>
<span class="co">#&gt; gender   gender    0  0.00</span>
<span class="co">#&gt; WC           WC    2  1.08</span>
<span class="co">#&gt; creat     creat    8  4.30</span>
<span class="co">#&gt; alc         alc   34 18.28</span></pre></body></html></div>
<p>To select only some of the parameters, they can be specified directly by name via the <code>other</code> element of <code>subset</code>.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"># densplot(mod13c, subset = list(other = c('creat', 'alc&gt;=1')))</pre></body></html></div>
<p>This also works when a subset of the imputed values should be displayed:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># re-fit the model and monitor the imputed values</span>
<span class="no">mod13d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="no">mod13a</span>, <span class="kw">monitor_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">imps</span> <span class="kw">=</span> <span class="fl">TRUE</span>))

<span class="co"># select all imputed values for 'WC' (4th column of M_lvlone)</span>
<span class="co"># sub3 &lt;- grep('M_lvlone\\[[[:digit:]]+,4\\]', parameters(mod13d), value = TRUE)</span>
<span class="co"># sub3</span>

<span class="co"># pass "sub3" to "subset" via "other", for example in a traceplot:</span>
<span class="co"># traceplot(mod13d, subset = list(other = sub3), ncol = 2)</span></pre></body></html></div>
<p>When the number of imputed values is large or in order to check convergence of random effects, it may not be feasible to plot and inspect all trace plots. In that case a random subset of, for instance the random effects, can be selected (output not shown):</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># re-fit the model monitoring the random effects</span>
<span class="no">mod13e</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="no">mod13b</span>, <span class="kw">monitor_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">ranef_main</span> <span class="kw">=</span> <span class="fl">TRUE</span>))

<span class="co"># extract random intercepts and random slopes</span>
<span class="no">ri</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">'^b_bmi_ID\\[[[:digit:]]+,1\\]$'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">mod13e</span>$<span class="no">MCMC</span><span class="kw">[[</span><span class="fl">1</span>]]), <span class="kw">value</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="no">rs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">'^b_bmi_ID\\[[[:digit:]]+,2\\]$'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">mod13e</span>$<span class="no">MCMC</span><span class="kw">[[</span><span class="fl">1</span>]]), <span class="kw">value</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="co"># to plot the chains of 12 randomly selected random intercepts and slopes:</span>
<span class="fu"><a href="../reference/traceplot.html">traceplot</a></span>(<span class="no">mod13e</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">other</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">ri</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>)), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">4</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span>(<span class="no">mod13e</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">other</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">rs</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>)), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">4</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-10-2.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="subset-of-mcmc-samples" class="section level3">
<h3 class="hasAnchor">
<a href="#subset-of-mcmc-samples" class="anchor"></a>Subset of MCMC samples</h3>
<p>With the arguments <code>start</code>, <code>end</code> and <code>thin</code> it is possible to select which iterations from the MCMC sample are included in the summary. <code>start</code> and <code>end</code> specify the first and last iterations to be used, <code>thin</code> the thinning interval. Specification of <code>start</code>, thus, allows discarding a “burn-in”, i.e., the iterations before the MCMC chain had converged.</p>
<p>If a particular chain does not have converged it can be excluded from the result summary or plot using the argument <code>exclude_chains</code> which takes a numeric vector identifying chains to be excluded, for example:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">mod14</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span>(<span class="no">SBP</span> ~ <span class="no">gender</span> + <span class="no">WC</span> + <span class="no">alc</span> + <span class="no">creat</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>, <span class="kw">n.iter</span> <span class="kw">=</span> <span class="fl">100</span>,
                <span class="kw">progress.bar</span> <span class="kw">=</span> <span class="st">'none'</span>, <span class="kw">n.chains</span> <span class="kw">=</span> <span class="fl">5</span>)

<span class="fu"><a href="../reference/densplot.html">densplot</a></span>(<span class="no">mod14</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="../reference/densplot.html">densplot</a></span>(<span class="no">mod14</span>, <span class="kw">exclude_chains</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">4</span>), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-11-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span>(<span class="no">mod14</span>, <span class="kw">thin</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span>(<span class="no">mod14</span>, <span class="kw">start</span> <span class="kw">=</span> <span class="fl">150</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-12-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/traceplot.html">traceplot</a></span>(<span class="no">mod14</span>, <span class="kw">end</span> <span class="kw">=</span> <span class="fl">120</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-12-3.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="predicted-values" class="section level2">
<h2 class="hasAnchor">
<a href="#predicted-values" class="anchor"></a>Predicted values</h2>
<p>Often, the aim of an analysis is not only to estimate the association between outcome and covariates but to predict future outcomes or outcomes for new subjects.</p>
<p>The function <a href="https://nerler.github.io/JointAI/reference/predict.JointAI.html"><code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code></a> allows us to obtain predicted values and corresponding credible intervals from <code>JointAI</code> objects. Note that for mixed models, currently, only marginal prediction but not prediction conditional on the random effects is implemented.</p>
<p>A dataset containing data which the prediction should be performed is specified via the argument <code>newdata</code>. If no <code>newdata</code> is given, the original data from the JointAI object are used. The argument <code>quantiles</code> allows the specification of the quantiles of the posterior sample that are used to obtain the credible interval (by default the 2.5% and 97.5% quantile). Arguments <code>start</code>, <code>end</code>, <code>thin</code> and <code>exclude_chains</code> control the subset of MCMC samples that is used.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mod13a</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">NHANES</span>[<span class="fl">27</span>, ])
<span class="co">#&gt; $newdata</span>
<span class="co">#&gt;          SBP gender age             race   WC alc educ creat albu</span>
<span class="co">#&gt; 392 126.6667   male  32 Mexican American 94.1  &lt;1  low  0.83  4.2</span>
<span class="co">#&gt;     uricacid bili occup  smoke      fit     2.5%    97.5%</span>
<span class="co">#&gt; 392      8.7    1  &lt;NA&gt; former 116.3889 112.5179 120.4794</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $fitted</span>
<span class="co">#&gt;        fit     2.5%    97.5%</span>
<span class="co">#&gt; 1 116.3889 112.5179 120.4794</span></pre></body></html></div>
<p><code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> returns a list with elements <code>dat</code>, <code>fit</code> and <code>quantiles</code>, containing <code>newdata</code> with the predicted values and quantiles appended, the predicted values and quantiles that form the credible interval.</p>
<div id="prediction-to-visualize-non-linear-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-to-visualize-non-linear-effects" class="anchor"></a>Prediction to visualize non-linear effects</h3>
<p>Another reason to obtain predicted values is the visualization of non-linear effects. To facilitate the generation of a dataset for such a prediction, the function <a href="https://nerler.github.io/JointAI/reference/predDF.html"><code><a href="../reference/predDF.html">predDF()</a></code></a> can be used. It generates a <code>data.frame</code> that contains a sequence of values through the range of observed values for a covariate specified by the argument <code>var</code>, and the median or reference value for all other continuous and categorical variables.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co"># create dataset for prediction</span>
<span class="no">newDF</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/predDF.html">predDF</a></span>(<span class="no">mod13b</span>, <span class="kw">var</span> <span class="kw">=</span> ~ <span class="no">age</span>)

<span class="co"># obtain predicted values</span>
<span class="no">pred</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">mod13b</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">newDF</span>)
<span class="co">#&gt; Warning: </span>
<span class="co">#&gt; Prediction for multi-level models is currently only possible</span>
<span class="co">#&gt; on the population level (not using random effects).</span>

<span class="co"># plot predicted values and credible interval</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span>(<span class="no">pred</span>$<span class="no">newdata</span>$<span class="no">age</span>, <span class="no">pred</span>$<span class="no">fitted</span>,
        <span class="kw">lty</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">'l'</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">1</span>,
        <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">'age in months'</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">'predicted value'</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-15-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="export-of-imputed-values" class="section level2">
<h2 class="hasAnchor">
<a href="#export-of-imputed-values" class="anchor"></a>Export of imputed values</h2>
<p>Imputed datasets can be extracted from a <code>JointAI</code> object (in which a monitor for the imputed values has been set, i.e., <code>monitor_params = c(imps = TRUE)</code>), with the function <a href="https://nerler.github.io/JointAI/reference/get_MIdat.html"><code><a href="../reference/get_MIdat.html">get_MIdat()</a></code></a>.</p>
<p>A completed dataset is created by taking the imputed values from a randomly chosen iteration of the MCMC sample, transforming them back to the original scale if scaling had been performed before the MCMC sampling, and filling them into the original incomplete data.</p>
<p>The argument <code>m</code> specifies the number of imputed datasets to be created, <code>include</code> controls whether the original data are included in the long format <code>data.frame</code> (default is <code>include = TRUE</code>), <code>start</code> specifies the first iteration that may be used and <code>minspace</code> is the minimum number of iterations between iterations eligible to be selected.</p>
<p>To make the selection of iterations to form the imputed data reproducible, a seed value can be specified via the argument <code>seed</code>.</p>
<p>When <code>export_to_SPSS = TRUE</code> the imputed data is exported to SPSS, i.e., a <code>.txt</code> file containing the data and a <code>.sps</code> file containing SPSS syntax to convert the data into an SPSS data file (with ending <code>.sav</code>) are written. Arguments <code>filename</code> and <code>resdir</code> allow the specification of the name of the <code>.txt</code> and <code>.sps</code> file and the directory they are written to.</p>
<p><code><a href="../reference/get_MIdat.html">get_MIdat()</a></code> returns a long-format <code>data.frame</code> containing the imputed datasets (and by default the original data) stacked onto each other. The imputation number is given in the variable <code>Imputation_</code>, column <code>.id</code> contains a newly created id variable for each observation in cross-sectional data (multi-level data should already contain an id variable).</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">impDF</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_MIdat.html">get_MIdat</a></span>(<span class="no">mod13d</span>, <span class="kw">m</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">2018</span>)</pre></body></html></div>
<p>The function <code><a href="../reference/plot_imp_distr.html">plot_imp_distr()</a></code> allows us to visually compare the distribution of the observed and imputed values.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_imp_distr.html">plot_imp_distr</a></span>(<span class="no">impDF</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Gelman, A. and Rubin, D.B. (1992). Inference from Iterative Simulation Using Multiple Sequences. <em>Statistical Science</em> <strong>7</strong>(4), 457-472. doi: 10.1214/ss/1177011136. <br><br> Brooks, S. P. and Gelman, A. (1998). General Methods for Monitoring Convergence of Iterative Simulations. <em>Journal of Computational and Graphical Statistics</em> <strong>7</strong>(4), 434 - 455. doi: 10.1080/10618600.1998.10474787.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Lesaffre, E. M. and A. B. Lawson (2012). <em>Bayesian Biostatistics</em>. John Wiley &amp; Sons. doi: 10.1002/9781119942412.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicole S. Erler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '0d21d69e7c3eb00e029f5b8d9424cd56',
    indexName: 'jointal',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
