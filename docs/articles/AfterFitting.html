<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>After Fitting • JointAI</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="After Fitting">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127879026-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127879026-4');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JointAI</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AfterFitting.html">After Fitting</a>
    </li>
    <li>
      <a href="../articles/MCMCsettings.html">MCMC Settings</a>
    </li>
    <li>
      <a href="../articles/MinimalExample.html">Minimal Example</a>
    </li>
    <li>
      <a href="../articles/ModelSpecification.html">Model Specification</a>
    </li>
    <li>
      <a href="../articles/SelectingParameters.html">Parameter Selection</a>
    </li>
    <li>
      <a href="../articles/VisualizingIncompleteData.html">Visualizing Incomplete Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nerler/JointAI">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/N_Erler">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>After Fitting</h1>
            <h3 class="subtitle">Summary, visualization and evaluation of the results</h3>
                        <h4 class="author">Nicole Erler</h4>
            
            <h4 class="date">2019-08-22</h4>
      
      
      <div class="hidden name"><code>AfterFitting.Rmd</code></div>

    </div>

    
    
<p>This vignette describes how the results from a <code>JointAI</code> model can be visualized, summarized and evaluated. We use the <a href="https://nerler.github.io/JointAI/reference/NHANES.html">NHANES</a> data for examples in cross-sectional data and the dataset <a href="https://nerler.github.io/JointAI/reference/simLong.html">simLong</a> for examples in longitudinal data. For more info on these datasets, check out the vignette <a href="https://nerler.github.io/JointAI/articles/VisualizingIncompleteData.html"><em>Visualizing Incomplete Data</em></a>, in which the distributions of variables and missing values in both sets is explored.</p>
<p>The functions described in this section use, by default, the full MCMC sample and show only the parameters of the analysis model. Arguments <code>start</code>, <code>end</code> and <code>thin</code> are available to select a subset of the MCMC samples that is used to calculate the summary. The argument <code>subset</code> allows controlling which part of the MCMC sample is returned and follows the same logic as the argument <code>monitor_params</code> in <code>*_imp()</code>. The use of these arguments is further explained <a href="#sec:subset">below</a>.</p>
<div id="visualizing-the-posterior-sample" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-the-posterior-sample" class="anchor"></a>Visualizing the posterior sample</h2>
<p>The posterior sample can be visualized by two commonly used plots: a traceplot, showing samples across iterations, or a plot of the empirical density of the posterior sample.</p>
<div id="traceplot" class="section level3">
<h3 class="hasAnchor">
<a href="#traceplot" class="anchor"></a>Traceplot</h3>
<p>A traceplot shows the sampled values per chain and node throughout iterations. It allows to visually evaluate convergence and mixing of the chains, and can be obtained with the function <code><a href="../reference/traceplot.html">traceplot()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>mod13a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_imp.html">lm_imp</a></span>(SBP <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>WC <span class="op">+</span><span class="st"> </span>alc <span class="op">+</span><span class="st"> </span>creat, <span class="dt">data =</span> NHANES, <span class="dt">n.iter =</span> <span class="dv">500</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="../reference/traceplot.html">traceplot</a></span>(mod13a)</span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-1-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>When the sampler has converged the chains show one horizontal band, as in the above figure. Consequently, when traces show a trend convergence has not been reached and more iterations are necessary (e.g., using <code><a href="../reference/add_samples.html">add_samples()</a></code>).</p>
<p>Graphical aspects of the traceplot can be controlled by specifying standard graphical arguments via the dots argument <code>"..."</code>, which are passed to <code>matplot()</code>. This allows changing color, linetype and -width, limits, etc. Arguments <code>nrow</code> and/or <code>ncol</code> can be supplied to set specific numbers of rows and columns for the layout of the grid of plots.</p>
<p>With the argument <code>use_ggplot</code> it is possible to get a <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> version of the traceplot. It can be extended using standard <strong>ggplot2</strong> syntax.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw"><a href="../reference/traceplot.html">traceplot</a></span>(mod13a, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">use_ggplot =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">'bottom'</span>) <span class="op">+</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">'Dark2'</span>)</span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/ggtrace15a-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="density-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#density-plot" class="anchor"></a>Density plot</h3>
<p>The posterior distributions can also be visualized using the function <code><a href="../reference/densplot.html">densplot()</a></code>, which plots the empirical density per node per chain, or combining chains (when <code>joined = TRUE</code>).</p>
<p>The argument <code>vlines</code> takes a list of lists, containing specifications passed to <code>abline</code>, and allows to add (vertical) lines to the plot, e.g., marking zero:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="../reference/densplot.html">densplot</a></span>(mod13a, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"darkred"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span>),</span>
<span id="cb3-2"><a href="#cb3-2"></a>         <span class="dt">vlines =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">v =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">nrow</span>(<span class="kw">summary</span>(mod13a)<span class="op">$</span>stats) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="ot">NA</span>),</span>
<span id="cb3-3"><a href="#cb3-3"></a>                            <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.8</span>))))</span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"> or marking the posterior mean and 2.5% and 97.5% quantiles:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="../reference/densplot.html">densplot</a></span>(mod13a, <span class="dt">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb4-2"><a href="#cb4-2"></a>         <span class="dt">vlines =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">v =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stats[, <span class="st">"Mean"</span>], <span class="dt">lty =</span> <span class="dv">1</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>                            <span class="dt">lwd =</span> <span class="dv">2</span>),</span>
<span id="cb4-4"><a href="#cb4-4"></a>                       <span class="kw">list</span>(<span class="dt">v =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stats[, <span class="st">"2.5%"</span>], <span class="dt">lty =</span> <span class="dv">2</span>),</span>
<span id="cb4-5"><a href="#cb4-5"></a>                       <span class="kw">list</span>(<span class="dt">v =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stats[, <span class="st">"97.5%"</span>], <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>         )</span>
<span id="cb4-7"><a href="#cb4-7"></a>)</span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/densplot15a-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Like with <code><a href="../reference/traceplot.html">traceplot()</a></code> it is possible to use the <strong>ggplot2</strong> version of <code><a href="../reference/densplot.html">densplot()</a></code> when setting <code>use_ggplot = TRUE</code>. Here, vertical lines can be added as additional layers:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># fit the complete-case version of the model</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>mod13a_cc &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">formula</span>(mod13a), <span class="dt">data =</span> NHANES)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># make a dataset containing the quantiles of the posterior sample and</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># confidence intervals from the complete case analysis:</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>quantDF &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">rownames</span>(<span class="kw">summary</span>(mod13a)<span class="op">$</span>stat),</span>
<span id="cb5-8"><a href="#cb5-8"></a>                            <span class="dt">type =</span> <span class="st">'2.5%'</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>                            <span class="dt">model =</span> <span class="st">'JointAI'</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>                            <span class="dt">value =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stat[, <span class="kw">c</span>(<span class="st">'2.5%'</span>)]</span>
<span id="cb5-11"><a href="#cb5-11"></a>                            ),</span>
<span id="cb5-12"><a href="#cb5-12"></a>                 <span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">rownames</span>(<span class="kw">summary</span>(mod13a)<span class="op">$</span>stat),</span>
<span id="cb5-13"><a href="#cb5-13"></a>                            <span class="dt">type =</span> <span class="st">'97.5%'</span>,</span>
<span id="cb5-14"><a href="#cb5-14"></a>                            <span class="dt">model =</span> <span class="st">'JointAI'</span>,</span>
<span id="cb5-15"><a href="#cb5-15"></a>                            <span class="dt">value =</span> <span class="kw">summary</span>(mod13a)<span class="op">$</span>stat[, <span class="kw">c</span>(<span class="st">'97.5%'</span>)]</span>
<span id="cb5-16"><a href="#cb5-16"></a>                 ),</span>
<span id="cb5-17"><a href="#cb5-17"></a>                 <span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">names</span>(<span class="kw">coef</span>(mod13a_cc)),</span>
<span id="cb5-18"><a href="#cb5-18"></a>                            <span class="dt">type =</span> <span class="st">'2.5%'</span>,</span>
<span id="cb5-19"><a href="#cb5-19"></a>                            <span class="dt">model =</span> <span class="st">'cc'</span>,</span>
<span id="cb5-20"><a href="#cb5-20"></a>                            <span class="dt">value =</span> <span class="kw">confint</span>(mod13a_cc)[, <span class="st">'2.5 %'</span>]</span>
<span id="cb5-21"><a href="#cb5-21"></a>                 ),</span>
<span id="cb5-22"><a href="#cb5-22"></a>                 <span class="kw">data.frame</span>(<span class="dt">variable =</span> <span class="kw">names</span>(<span class="kw">coef</span>(mod13a_cc)),</span>
<span id="cb5-23"><a href="#cb5-23"></a>                            <span class="dt">type =</span> <span class="st">'97.5%'</span>,</span>
<span id="cb5-24"><a href="#cb5-24"></a>                            <span class="dt">model =</span> <span class="st">'cc'</span>,</span>
<span id="cb5-25"><a href="#cb5-25"></a>                            <span class="dt">value =</span> <span class="kw">confint</span>(mod13a_cc)[, <span class="st">'97.5 %'</span>]</span>
<span id="cb5-26"><a href="#cb5-26"></a>                 )</span>
<span id="cb5-27"><a href="#cb5-27"></a>)</span>
<span id="cb5-28"><a href="#cb5-28"></a></span>
<span id="cb5-29"><a href="#cb5-29"></a></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co"># ggplot version:</span></span>
<span id="cb5-31"><a href="#cb5-31"></a>p13a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/densplot.html">densplot</a></span>(mod13a, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">use_ggplot =</span> <span class="ot">TRUE</span>, <span class="dt">joined =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">'bottom'</span>)</span>
<span id="cb5-33"><a href="#cb5-33"></a></span>
<span id="cb5-34"><a href="#cb5-34"></a></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co"># add vertical lines for the:</span></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="co"># - confidence intervals from the complete case analysis</span></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="co"># - quantiles of the posterior distribution</span></span>
<span id="cb5-38"><a href="#cb5-38"></a>p13a <span class="op">+</span></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> quantDF, <span class="kw">aes</span>(<span class="dt">xintercept =</span> value, <span class="dt">color =</span> model),</span>
<span id="cb5-40"><a href="#cb5-40"></a>             <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">'CI from model: '</span>, </span>
<span id="cb5-42"><a href="#cb5-42"></a>                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="st">'JointAI'</span>, <span class="st">'cc'</span>),</span>
<span id="cb5-43"><a href="#cb5-43"></a>                     <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">'blue'</span>, <span class="st">'red'</span>),</span>
<span id="cb5-44"><a href="#cb5-44"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">'JointAI'</span>, <span class="st">'compl.case'</span>))</span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/ggdens15a-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="model-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#model-summary" class="anchor"></a>Model Summary</h2>
<p>A summary of the posterior distribution estimated in a <code>JointAI</code> model can be obtained using the function <code>summary()</code>.</p>
<p>The posterior summary consists of the mean, standard deviation and quantiles (by default the 2.5% and 97.5% quantiles) of the MCMC samples from all chains combined, as well as the tail probability (see below) and Gelman-Rubin criterion (see <a href="#sec:grcrit">section below</a>).</p>
<p>Additionally, some important characteristics of the MCMC samples on which the summary is based is given. This includes the range and number of iterations (“Sample size per chain”), thinning interval and number of chains. Furthermore, the number of observations (number of rows in the data) is given.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">summary</span>(mod13a)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#&gt; </span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt;  Linear model fitted with JointAI </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; Call:</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt;     n.iter = 500)</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; Posterior summary:</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;                Mean     SD   2.5%   97.5% tail-prob. GR-crit</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; (Intercept)  80.819 9.5122 62.738 100.459      0.000    1.00</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; genderfemale  0.485 2.6142 -4.884   5.531      0.841    1.01</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; WC            0.306 0.0729  0.165   0.455      0.000    1.00</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; alc&gt;=1        6.332 2.4548  1.554  11.057      0.008    1.00</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; creat         8.030 7.4471 -6.218  22.864      0.280    1.00</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; </span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt; Posterior summary of residual std. deviation:</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt;           Mean    SD 2.5% 97.5% GR-crit</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt; sigma_SBP 14.4 0.774   13    16       1</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt; </span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt; </span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#&gt; MCMC settings:</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt; Iterations = 101:600</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">#&gt; Sample size per chain = 500 </span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">#&gt; Thinning interval = 1 </span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">#&gt; Number of chains = 3 </span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="co">#&gt; </span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="co">#&gt; Number of observations: 186</span></span></code></pre></div>
<p>For mixed models, <code>summary()</code> also returns the posterior summary of the random effects covariance matrix <code>D</code> and the number of groups:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">library</span>(splines)</span>
<span id="cb7-2"><a href="#cb7-2"></a>mod13b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_imp.html">lme_imp</a></span>(bmi <span class="op">~</span><span class="st"> </span>GESTBIR <span class="op">+</span><span class="st"> </span>ETHN <span class="op">+</span><span class="st"> </span>HEIGHT_M <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">3</span>),</span>
<span id="cb7-3"><a href="#cb7-3"></a>                  <span class="dt">random =</span> <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(age, <span class="dt">df =</span> <span class="dv">1</span>) <span class="op">|</span><span class="st"> </span>ID,</span>
<span id="cb7-4"><a href="#cb7-4"></a>                  <span class="dt">data =</span> <span class="kw">subset</span>(simLong, <span class="op">!</span><span class="kw">is.na</span>(bmi)),</span>
<span id="cb7-5"><a href="#cb7-5"></a>                  <span class="dt">n.iter =</span> <span class="dv">500</span>, <span class="dt">no_model =</span> <span class="st">'age'</span>, <span class="dt">seed =</span> <span class="dv">2019</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="kw">summary</span>(mod13b)</span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt;  Linear mixed model fitted with JointAI </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; </span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; Call:</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; lme_imp(fixed = bmi ~ GESTBIR + ETHN + HEIGHT_M + ns(age, df = 3), </span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt;     data = subset(simLong, !is.na(bmi)), random = ~ns(age, df = 1) | </span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt;         ID, n.iter = 500, no_model = "age", seed = 2019)</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; </span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt; Posterior summary:</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt;                     Mean      SD    2.5%   97.5% tail-prob. GR-crit</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; (Intercept)      16.6534 2.30967 12.4011 21.2808      0.000    1.01</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&gt; GESTBIR          -0.0332 0.04725 -0.1300  0.0577      0.492    1.01</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&gt; ETHNother         0.0452 0.14500 -0.2416  0.3377      0.773    1.01</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&gt; HEIGHT_M          0.0025 0.00939 -0.0156  0.0200      0.775    1.01</span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&gt; ns(age, df = 3)1 -0.2626 0.07757 -0.4149 -0.1065      0.000    1.00</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt; ns(age, df = 3)2  1.9280 0.13030  1.6664  2.1880      0.000    1.00</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&gt; ns(age, df = 3)3 -1.2385 0.09170 -1.4160 -1.0544      0.000    1.00</span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">#&gt; </span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co">#&gt; Posterior summary of random effects covariance matrix:</span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="co">#&gt;          Mean     SD   2.5%  97.5% tail-prob. GR-crit</span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co">#&gt; D[1,1]  0.766 0.0875  0.612  0.941               1.01</span></span>
<span id="cb7-29"><a href="#cb7-29"></a><span class="co">#&gt; D[1,2] -0.421 0.1240 -0.665 -0.194          0    1.02</span></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co">#&gt; D[2,2]  2.361 0.3149  1.827  3.025               1.02</span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="co">#&gt; </span></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="co">#&gt; Posterior summary of residual std. deviation:</span></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="co">#&gt;           Mean     SD  2.5% 97.5% GR-crit</span></span>
<span id="cb7-34"><a href="#cb7-34"></a><span class="co">#&gt; sigma_bmi 0.57 0.0101 0.551  0.59       1</span></span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="co">#&gt; </span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="co">#&gt; </span></span>
<span id="cb7-37"><a href="#cb7-37"></a><span class="co">#&gt; MCMC settings:</span></span>
<span id="cb7-38"><a href="#cb7-38"></a><span class="co">#&gt; Iterations = 101:600</span></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="co">#&gt; Sample size per chain = 500 </span></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="co">#&gt; Thinning interval = 1 </span></span>
<span id="cb7-41"><a href="#cb7-41"></a><span class="co">#&gt; Number of chains = 3 </span></span>
<span id="cb7-42"><a href="#cb7-42"></a><span class="co">#&gt; </span></span>
<span id="cb7-43"><a href="#cb7-43"></a><span class="co">#&gt; Number of observations: 1881 </span></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="co">#&gt; Number of groups: 200</span></span></code></pre></div>
<div id="tail-probability" class="section level3">
<h3 class="hasAnchor">
<a href="#tail-probability" class="anchor"></a>Tail probability</h3>
<p>The tail probability, calculated as <span class="math inline">\(2\times\min\left\{Pr(\theta &gt; 0), Pr(\theta &lt; 0)\right\},\)</span> where <span class="math inline">\(\theta\)</span> is the parameter of interest, is a measure of how likely the value 0 is under the estimated posterior distribution. The figure visualizes three examples of posterior distributions and the corresponding minimum of <span class="math inline">\(Pr(\theta &gt; 0)\)</span> and <span class="math inline">\(Pr(\theta &lt; 0)\)</span> (shaded area): <img src="AfterFitting_files/figure-html/tailprob-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>By default, <code>summary()</code> will only print the posterior summary for the main model parameters of the analysis model and use the whole MCMC sample. The argument <code>subset</code> allows to control which part of the MCMC sample is returned and follows the same logic as the argument <code>monitor_params</code> in <code>*_imp()</code>. Arguments <code>start</code>, <code>end</code> and <code>thin</code> are available to select a subset of the MCMC samples that is used to calculate the summary. The use of these arguments is further explained <a href="#sec:subset">below</a>).</p>
</div>
</div>
<div id="evaluation-criteria" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluation-criteria" class="anchor"></a>Evaluation criteria</h2>
<p>The convergence of the MCMC chains and precision of the posterior sample can also be evaluated more formally. Implemented in <strong>JointAI</strong> are the Gelman-Rubin criterion for convergence<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and a comparison of the Monte Carlo Error with the posterior standard deviation.</p>
<div id="sec:grcrit" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:grcrit" class="anchor"></a>Gelman-Rubin criterion for convergence</h3>
<p>The Gelman-Rubin criterion evaluates convergence by comparing within and between chain variability and, thus, requires at least two MCMC chains to be calculated. It is implemented for <code>JointAI</code> objects in the function <a href="https://nerler.github.io/JointAI/reference/GR_crit.html"><code><a href="../reference/GR_crit.html">GR_crit()</a></code></a>, which is based on the function <code>gelman.diag()</code> from the package <a href="https://CRAN.R-project.org/package=coda"><strong>coda</strong></a>. The upper limit of the confidence interval should not be much larger than 1.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="../reference/GR_crit.html">GR_crit</a></span>(mod13a)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#&gt; Potential scale reduction factors:</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt; </span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt;              Point est. Upper C.I.</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; (Intercept)        1.00       1.01</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; genderfemale       1.00       1.01</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; WC                 1.00       1.02</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; alc&gt;=1             1.00       1.01</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; creat              1.01       1.01</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt; sigma_SBP          1.00       1.01</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; Multivariate psrf</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt; </span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt; 1.01</span></span></code></pre></div>
<p>Besides the arguments <code>start</code>, <code>end</code>, <code>thin</code>, and <code>subset</code>, which are explained <a href="#sec:subset">below</a>, <code><a href="../reference/GR_crit.html">GR_crit()</a></code> also takes the arguments of <code>gelman.diag()</code>.</p>
</div>
<div id="sec:mcerror" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:mcerror" class="anchor"></a>Monte Carlo Error</h3>
<p>The precision of the MCMC sample can be checked with the function <a href="https://nerler.github.io/JointAI/reference/MC_error.html"><code><a href="../reference/MC_error.html">MC_error()</a></code></a>. It uses the function <code>mcmcse.mat()</code> from the package <a href="https://CRAN.R-project.org/package=mcmcse"><strong>mcmcse</strong></a> to calculate the Monte Carlo error (the error that is made since the sample is finite) and compares it to the standard deviation of the posterior sample. A rule of thumb is that the Monte Carlo error should not be more than 5% of the standard deviation<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. Besides the arguments explained <a href="#sec:subset">below</a>, <code><a href="../reference/MC_error.html">MC_error()</a></code> takes the arguments of <code>mcmcse.mat()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="../reference/MC_error.html">MC_error</a></span>(mod13a)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#&gt;                est   MCSE    SD MCSE/SD</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt; (Intercept)  80.82 0.2592 9.512   0.027</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; genderfemale  0.49 0.0777 2.614   0.030</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt; WC            0.31 0.0017 0.073   0.024</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; alc&gt;=1        6.33 0.0853 2.455   0.035</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; creat         8.03 0.2171 7.447   0.029</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; sigma_SBP    14.41 0.0172 0.774   0.022</span></span></code></pre></div>
<p><code><a href="../reference/MC_error.html">MC_error()</a></code> returns an object of class <code>MCElist</code>, which is a list containing matrices with the posterior mean, estimated Monte Carlo error, posterior standard deviation and the ratio of the Monte Carlo error to the posterior standard deviation, for the scaled (if they are part of the <code>JointAI</code> object) and unscaled (transformed back to the scale of the data) posterior samples. The associated print method prints only the latter.</p>
<p>To facilitate quick evaluation of the Monte Carlo error to posterior standard deviation ratio, plotting of an object of class <code>MCElist</code> using <code>plot()</code> shows this ratio for each (selected) node and automatically adds a vertical line at the desired cut-off (by default 5%).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">0.6</span>, <span class="dv">0</span>), <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">plot</span>(<span class="kw"><a href="../reference/MC_error.html">MC_error</a></span>(mod13a))  <span class="co"># left panel: all iterations 101:600</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">plot</span>(<span class="kw"><a href="../reference/MC_error.html">MC_error</a></span>(mod13a, <span class="dt">end =</span> <span class="dv">250</span>))  <span class="co"># right panel: iterations 101:250</span></span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/MCE15a-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="sec:subset" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:subset" class="anchor"></a>Subset of output</h2>
<p>By default, the functions <code><a href="../reference/traceplot.html">traceplot()</a></code>, <code><a href="../reference/densplot.html">densplot()</a></code>, <code>summary()</code>, <code><a href="../reference/GR_crit.html">GR_crit()</a></code> and <code>MC_Error()</code> use all iterations of the MCMC sample and consider only the parameters of the analysis model (if they were monitored). In this section, we describe how the set of iterations and parameters to display can be changed using the arguments <code>subset</code>, <code>start</code>, <code>end</code> and <code>thin</code>.</p>
<div id="subset-of-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#subset-of-parameters" class="anchor"></a>Subset of parameters</h3>
<p>As long as the main parameters have been monitored in a <code>JointAI</code> object, only these parameters are returned in the model summary, plots and criteria shown above. When the main parameters of the analysis model were not monitored, i.e., <code>monitor_params = c(analysis_main = FALSE)</code>, and the argument <code>subset</code> is not specified, all parameters that were monitored are displayed.</p>
<p>To display output for nodes other than the main parameters of the analysis model or for a subset of nodes, the argument <code>subset</code> needs to be specified.</p>
<div id="examples" class="section level4">
<h4 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h4>
<p>To display only the parameters of the imputation models, we set <code>subset = c(analysis_main = FALSE, imp_pars = TRUE)</code> (after re-estimating the model with the monitor for these parameters switched on):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>mod13c &lt;-<span class="st"> </span><span class="kw">update</span>(mod13a, <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">imp_pars =</span> <span class="ot">TRUE</span>))</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">summary</span>(mod13c, <span class="dt">subset =</span> <span class="kw">c</span>(<span class="dt">analysis_main =</span> <span class="ot">FALSE</span>, <span class="dt">imp_pars =</span> <span class="ot">TRUE</span>))</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#&gt; </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt;  Linear model fitted with JointAI </span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; Call:</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; lm_imp(formula = SBP ~ gender + WC + alc + creat, data = NHANES, </span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt;     n.iter = 500, monitor_params = c(imp_pars = TRUE))</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; </span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; Posterior summary:</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt;              Mean     SD    2.5%   97.5% tail-prob. GR-crit</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; alpha[1]   0.1644 0.1011 -0.0297  0.3654     0.0880    1.00</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; alpha[2]  -0.3537 0.1492 -0.6476 -0.0608     0.0187    1.01</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; alpha[3]   0.4917 0.0862  0.3211  0.6630     0.0000    1.00</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt; alpha[4]  -1.0420 0.1281 -1.3031 -0.7830     0.0000    1.00</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">#&gt; alpha[5]   0.0741 0.0653 -0.0603  0.1989     0.2573    1.00</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#&gt; alpha[6]  -0.1396 0.2391 -0.5974  0.3248     0.5427    1.05</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">#&gt; alpha[7]  -0.8796 0.4223 -1.7223 -0.0750     0.0280    1.07</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">#&gt; alpha[8]   0.1049 0.1753 -0.2355  0.4470     0.5373    1.01</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">#&gt; alpha[9]  -0.2545 0.2124 -0.6812  0.1503     0.2427    1.04</span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="co">#&gt; tau_WC     1.0292 0.1051  0.8307  1.2457     0.0000    1.00</span></span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="co">#&gt; tau_creat  1.3992 0.1486  1.1328  1.7211     0.0000    1.00</span></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co">#&gt; </span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co">#&gt; </span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="co">#&gt; MCMC settings:</span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co">#&gt; Iterations = 101:600</span></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="co">#&gt; Sample size per chain = 500 </span></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="co">#&gt; Thinning interval = 1 </span></span>
<span id="cb11-29"><a href="#cb11-29"></a><span class="co">#&gt; Number of chains = 3 </span></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="co">#&gt; </span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="co">#&gt; Number of observations: 186</span></span></code></pre></div>
<p>To select only some of the parameters, they can be specified directly by name via the <code>other</code> element of <code>subset</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw"><a href="../reference/densplot.html">densplot</a></span>(mod13c, <span class="dt">subset =</span> <span class="kw">list</span>(<span class="dt">other =</span> <span class="kw">c</span>(<span class="st">'creat'</span>, <span class="st">'alc&gt;=1'</span>)))</span></code></pre></div>
<p>This also works when a subset of the imputed values should be displayed:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># re-fit the model and monitor the imputed values</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>mod13d &lt;-<span class="st"> </span><span class="kw">update</span>(mod13a, <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">imps =</span> <span class="ot">TRUE</span>))</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># select all imputed values for 'WC' (3rd column of Xc)</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>sub3 &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">'Xc</span><span class="ch">\\</span><span class="st">[[[:digit:]]+,3</span><span class="ch">\\</span><span class="st">]'</span>, <span class="kw"><a href="../reference/parameters.html">parameters</a></span>(mod13d), <span class="dt">value =</span> <span class="ot">TRUE</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>sub3</span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt; [1] "Xc[33,3]"  "Xc[150,3]"</span></span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co"># pass "sub3" to "subset" via "other", for example in a traceplot:</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co"># traceplot(mod13d, subset = list(other = sub3), ncol = 2)</span></span></code></pre></div>
<p>When the number of imputed values is large or in order to check convergence of random effects, it may not be feasible to plot and inspect all traceplots. In that case a random subset of, for instance the random effects, can be selected (output not shown):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># re-fit the model monitoring the random effects</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>mod13e &lt;-<span class="st"> </span><span class="kw">update</span>(mod13b, <span class="dt">monitor_params =</span> <span class="kw">c</span>(<span class="dt">ranef =</span> <span class="ot">TRUE</span>))</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co"># extract random intercepts and random slopes</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>ri &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">'^b</span><span class="ch">\\</span><span class="st">[[[:digit:]]+,1</span><span class="ch">\\</span><span class="st">]$'</span>, <span class="kw">colnames</span>(mod13e<span class="op">$</span>MCMC[[<span class="dv">1</span>]]), <span class="dt">value =</span> T)</span>
<span id="cb14-6"><a href="#cb14-6"></a>rs &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">'^b</span><span class="ch">\\</span><span class="st">[[[:digit:]]+,2</span><span class="ch">\\</span><span class="st">]$'</span>, <span class="kw">colnames</span>(mod13e<span class="op">$</span>MCMC[[<span class="dv">1</span>]]), <span class="dt">value =</span> T)</span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co"># to plot the chains of 12 randomly selected random intercepts and slopes:</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="kw"><a href="../reference/traceplot.html">traceplot</a></span>(mod13e, <span class="dt">subset =</span> <span class="kw">list</span>(<span class="dt">other =</span> <span class="kw">sample</span>(ri, <span class="dt">size =</span> <span class="dv">12</span>)), <span class="dt">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="kw"><a href="../reference/traceplot.html">traceplot</a></span>(mod13e, <span class="dt">subset =</span> <span class="kw">list</span>(<span class="dt">other =</span> <span class="kw">sample</span>(rs, <span class="dt">size =</span> <span class="dv">12</span>)), <span class="dt">ncol =</span> <span class="dv">4</span>)</span></code></pre></div>
</div>
</div>
<div id="subset-of-mcmc-samples" class="section level3">
<h3 class="hasAnchor">
<a href="#subset-of-mcmc-samples" class="anchor"></a>Subset of MCMC samples</h3>
<p>With the arguments <code>start</code>, <code>end</code> and <code>thin</code> it is possible to select which iterations from the MCMC sample are included in the summary. <code>start</code> and <code>end</code> specify the first and last iterations to be used, <code>thin</code> the thinning interval. Specification of <code>start</code>, thus, allows discarding a “burn-in”, i.e., the iterations before the MCMC chain had converged.</p>
</div>
</div>
<div id="predicted-values" class="section level2">
<h2 class="hasAnchor">
<a href="#predicted-values" class="anchor"></a>Predicted values</h2>
<p>Often, the aim of an analysis is not only to estimate the association between outcome and covariates but to predict future outcomes or outcomes for new subjects.</p>
<p>The function <a href="https://nerler.github.io/JointAI/reference/predict.JointAI.html"><code>predict()</code></a> allows obtaining predicted values and corresponding prediction intervals from <code>JointAI</code> objects. Note that for mixed models, currently, only marginal prediction but not prediction conditional on the random effects is implemented.</p>
<p>A dataset containing data which the prediction should be performed is specified via the argument <code>newdata</code>. The argument <code>quantiles</code> allows specifying the quantiles of the posterior sample that are used to obtain the prediction interval (by default the 2.5% and 97.5% quantile). Arguments <code>start</code>, <code>end</code> and <code>thin</code> control the subset of MCMC samples used.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">predict</span>(mod13a, <span class="dt">newdata =</span> NHANES[<span class="dv">27</span>, ])</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt; $dat</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt;          SBP gender age             race   WC alc educ creat albu</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; 392 126.6667   male  32 Mexican American 94.1  &lt;1  low  0.83  4.2</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt;     uricacid bili occup  smoke     fit     2.5%    97.5%</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt; 392      8.7    1  &lt;NA&gt; former 116.235 112.3918 120.0668</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; </span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">#&gt; $fit</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">#&gt; [1] 116.235</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">#&gt; </span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt; $quantiles</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt;          2.5%    97.5%</span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">#&gt; [1,] 112.3918 120.0668</span></span></code></pre></div>
<p><code>predict()</code> returns a list with elements <code>dat</code>, <code>fit</code> and <code>quantiles</code>, containing <code>newdata</code> with the predicted values and quantiles appended, the predicted values and quantiles that form the prediction interval.</p>
<div id="prediction-to-visualize-non-linear-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-to-visualize-non-linear-effects" class="anchor"></a>Prediction to visualize non-linear effects</h3>
<p>Another reason to obtain predicted values is the visualization of non-linear effects. To facilitate the generation of a dataset for such a prediction, the function <a href="https://nerler.github.io/JointAI/reference/predDF.html"><code><a href="../reference/predDF.html">predDF()</a></code></a> can be used. It generates a <code>data.frame</code> that contains a sequence of values through the range of observed values for a covariate specified by the argument <code>var</code>, and the median or reference value for all other continuous and categorical variables.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># create dataset for prediction</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>newDF &lt;-<span class="st"> </span><span class="kw"><a href="../reference/predDF.html">predDF</a></span>(mod13b, <span class="dt">var =</span> <span class="st">"age"</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co"># obtain predicted values</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(mod13b, <span class="dt">newdata =</span> newDF)</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co"># plot predicted values and prediction interval</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="kw">matplot</span>(pred<span class="op">$</span>dat<span class="op">$</span>age, pred<span class="op">$</span>dat[, <span class="kw">c</span>(<span class="st">'fit'</span>, <span class="st">'2.5%'</span>, <span class="st">'97.5%'</span>)],</span>
<span id="cb16-9"><a href="#cb16-9"></a>        <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="dv">1</span>,</span>
<span id="cb16-10"><a href="#cb16-10"></a>        <span class="dt">xlab =</span> <span class="st">'age in months'</span>, <span class="dt">ylab =</span> <span class="st">'predicted value'</span>)</span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-13-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="export-of-imputed-values" class="section level2">
<h2 class="hasAnchor">
<a href="#export-of-imputed-values" class="anchor"></a>Export of imputed values</h2>
<p>Imputed datasets can be extracted from a <code>JointAI</code> object (in which a monitor for the imputed values has been set, i.e., <code>monitor_params = c(imps = TRUE)</code>), with the function <a href="https://nerler.github.io/JointAI/reference/get_MIdat.html"><code><a href="../reference/get_MIdat.html">get_MIdat()</a></code></a>.</p>
<p>A completed dataset is created by taking the imputed values from a randomly chosen iteration of the MCMC sample, transforming them back to the original scale if scaling had been performed before the MCMC sampling, and filling them into the original incomplete data.</p>
<p>The argument <code>m</code> specifies the number of imputed datasets to be created, <code>include</code> controls whether the original data are included in the long format <code>data.frame</code> (default is <code>include = TRUE</code>), <code>start</code> specifies the first iteration that may be used and <code>minspace</code> is the minimum number of iterations between iterations eligible to be selected.</p>
<p>To make the selection of iterations to form the imputed data reproducible, a seed value can be specified via the argument <code>seed</code>.</p>
<p>When <code>export_to_SPSS = TRUE</code> the imputed data is exported to SPSS, i.e., a <code>.txt</code> file containing the data and a <code>.sps</code> file containing SPSS syntax to convert the data into an SPSS data file (with ending <code>.sav</code>) are written. Arguments <code>filename</code> and <code>resdir</code> allow the specification of the name of the <code>.txt</code> and <code>.sps</code> file and the directory they are written to.</p>
<p><code><a href="../reference/get_MIdat.html">get_MIdat()</a></code> returns a long-format <code>data.frame</code> containing the imputed datasets (and by default the original data) stacked onto each other. The imputation number is given in the variable <code>Imputation_</code>, column <code>.id</code> contains a newly created id variable for each observation in cross-sectional data (multi-level data should already contain an id variable).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>impDF &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_MIdat.html">get_MIdat</a></span>(mod13d, <span class="dt">m =</span> <span class="dv">10</span>, <span class="dt">seed =</span> <span class="dv">2018</span>)</span></code></pre></div>
<p>The function <code><a href="../reference/plot_imp_distr.html">plot_imp_distr()</a></code> allows to visually compare the distribution of the observed and imputed values.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw"><a href="../reference/plot_imp_distr.html">plot_imp_distr</a></span>(impDF, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="AfterFitting_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Gelman, A. and Rubin, D.B. (1992). Inference from Iterative Simulation Using Multiple Sequences. <em>Statistical Science</em> <strong>7</strong>(4), 457-472. doi: 10.1214/ss/1177011136. <br><br> Brooks, S. P. and Gelman, A. (1998). General Methods for Monitoring Convergence of Iterative Simulations. <em>Journal of Computational and Graphical Statistics</em> <strong>7</strong>(4), 434 - 455. doi: 10.1080/10618600.1998.10474787.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Lesaffre, E. M. and A. B. Lawson (2012). <em>Bayesian Biostatistics</em>. John Wiley &amp; Sons. doi: 10.1002/9781119942412.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#visualizing-the-posterior-sample">Visualizing the posterior sample</a></li>
      <li><a href="#model-summary">Model Summary</a></li>
      <li><a href="#evaluation-criteria">Evaluation criteria</a></li>
      <li><a href="#sec:subset">Subset of output</a></li>
      <li><a href="#predicted-values">Predicted values</a></li>
      <li><a href="#export-of-imputed-values">Export of imputed values</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nicole S. Erler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script>
  docsearch({
    
    
    apiKey: '0d21d69e7c3eb00e029f5b8d9424cd56',
    indexName: 'JointAI',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
