<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCMC Settings • JointAI</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="MCMC Settings">
<meta property="og:description" content="JointAI">
<meta property="og:image" content="https://nerler.github.io/JointAI/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127879026-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127879026-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JointAI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AfterFitting.html">After Fitting</a>
    </li>
    <li>
      <a href="../articles/MCMCsettings.html">MCMC Settings</a>
    </li>
    <li>
      <a href="../articles/MinimalExample.html">Minimal Example</a>
    </li>
    <li>
      <a href="../articles/ModelSpecification.html">Model Specification</a>
    </li>
    <li>
      <a href="../articles/SelectingParameters.html">Parameter Selection</a>
    </li>
    <li>
      <a href="../articles/TheoreticalBackground.html">Theoretical Background</a>
    </li>
    <li>
      <a href="../articles/VisualizingIncompleteData.html">Visualizing Incomplete Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nerler/JointAI/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/N_Erler">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MCMC Settings</h1>
            
            <h4 class="date">2019-08-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nerler/JointAI/blob/master/vignettes/MCMCsettings.Rmd"><code>vignettes/MCMCsettings.Rmd</code></a></small>
      <div class="hidden name"><code>MCMCsettings.Rmd</code></div>

    </div>

    
    
<p>In <strong>JointAI</strong>, models are estimated in the Bayesian framework, using MCMC (<a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">Markov Chain Monte Carlo</a>) sampling. The sampling is done by the software <a href="http://mcmc-jags.sourceforge.net/">JAGS</a> (“Just Another Gibbs Sampler”), which performs <a href="https://en.wikipedia.org/wiki/Gibbs_sampling">Gibbs</a> sampling. <strong>JointAI</strong> pre-processes the data to get it into a form that can be passed to JAGS and writes the JAGS model. The R package <a href="https://CRAN.R-project.org/package=rjags"><strong>rjags</strong></a> is used as an interface to JAGS.</p>
<p>Here, we describe how to specify the arguments in the main functions that control MCMC related settings. To learn more about how to specify the other arguments in <strong>JointAI</strong> models or the theoretical background of the statistical approach, check out the vignettes <a href="https://nerler.github.io/JointAI/articles/ModelSpecification.html"><em>Model Specification</em></a> and <a href="https://nerler.github.io/JointAI/articles/TheoreticalBackground.html"><em>TheoreticalBackground</em></a>.</p>
<p>In this vignette, we use the <a href="https://nerler.github.io/JointAI/reference/NHANES.html">NHANES</a> data for examples in cross-sectional data and the dataset <a href="https://nerler.github.io/JointAI/reference/simLong.html">simLong</a> for examples in longitudinal data. For more info on these datasets, check out the vignette <a href="https://nerler.github.io/JointAI/articles/VisualizingIncompleteData.html"><em>Visualizing Incomplete Data</em></a>, in which the distributions of variables and missing values in both sets is explored.</p>
<p><strong>Note:</strong><br> In several examples we use <code>progress.bar = 'none'</code> which prevents printing of the progress of the MCMC sampling, since this would result in lengthy output in the vignette.</p>
<div id="mcmc-related-parameters-in-jointai" class="section level2">
<h2 class="hasAnchor">
<a href="#mcmc-related-parameters-in-jointai" class="anchor"></a>MCMC related parameters in <strong>JointAI</strong>
</h2>
<p>The main functions <a href="https://nerler.github.io/JointAI/reference/model_imp.html"><code>*_imp()</code></a> have a number of arguments that specify settings for the MCMC sampling:</p>
<ul>
<li>
<code>n.chains</code>: number of MCMC chains</li>
<li>
<code>n.adapt</code>: number of iterations in the adaptive phase</li>
<li>
<code>n.iter</code>: number of iterations in the sampling phase</li>
<li>
<code>thin</code>: thinning degree</li>
<li>
<code>monitor_params</code>: parameters/nodes to be monitored</li>
<li>
<code>seed</code>: optional seed value for reproducibility</li>
<li>
<code>inits</code>: initial values</li>
<li>
<code>parallel</code>: whether the MCMC chains should be sampled in parallel</li>
<li>
<code>n.cores</code>: how many cores are used for parallel sampling</li>
</ul>
<p>And some other parameters passed to functions from <strong>rjags</strong>:</p>
<ul>
<li>
<code>quiet</code>: should printing of information be suppressed?</li>
<li>
<code>progress.bar</code>: type of progress bar</li>
</ul>
</div>
<div id="chains-and-iterations" class="section level2">
<h2 class="hasAnchor">
<a href="#chains-and-iterations" class="anchor"></a>Chains and Iterations</h2>
<p>In MCMC sampling, values are drawn from a probability distribution. The distribution of the current value is drawn from depends on the previously drawn value (but not on values before that). Values, thus, form a chain. Once the chain has converged, its elements can be seen as a sample from the target posterior distribution.</p>
<div id="number-of-chains" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-chains" class="anchor"></a>Number of chains</h3>
<p>To evaluate the convergence of MCMC chains it is helpful to create multiple chains that have different starting values. The argument <code>n.chains</code> selects the number of chains (by default, <code>n.chains = 3</code>).</p>
<p>For calculating the model summary, multiple chains are merged.</p>
</div>
<div id="adaptive-phase" class="section level3">
<h3 class="hasAnchor">
<a href="#adaptive-phase" class="anchor"></a>Adaptive phase</h3>
<p>JAGS has an adaptive mode, in which samplers are optimized (for example the step size is adjusted). Samples obtained during the adaptive mode do not form a Markov chain and are discarded. The argument <code>n.adapt</code> controls the length of this adaptive phase.</p>
<p>The default value for <code>n.adapt</code> is 100, which works well in many of the examples considered here. Complex models may require longer adaptive phases. If the adaptive phase is not sufficient for JAGS to optimize the samplers, a warning message will be printed (see example below).</p>
</div>
<div id="sampling-iterations" class="section level3">
<h3 class="hasAnchor">
<a href="#sampling-iterations" class="anchor"></a>Sampling iterations</h3>
<p><code>n.iter</code> specifies the number of iterations in the sampling phase, i.e., the length of the MCMC chain. How many samples are required to reach convergence and to have sufficient precision depends on the complexity of data and model, and may range from as few as 100 to several million.</p>
<div id="side-note-how-to-evaluate-convergence" class="section level4">
<h4 class="hasAnchor">
<a href="#side-note-how-to-evaluate-convergence" class="anchor"></a>Side note: How to evaluate convergence?</h4>
<p>Convergence can, for instance, be evaluated visually using a <a href="https://nerler.github.io/JointAI/reference/traceplot.html"><code><a href="../reference/traceplot.html">traceplot()</a></code></a> or using the Gelman-Rubin diagnostic criterion<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> (implemented in <a href="https://nerler.github.io/JointAI/reference/GR_crit.html"><code><a href="../reference/GR_crit.html">GR_crit()</a></code></a>, but also returned with the model summary). The latter compares within and between chain variability and requires the JointAI object to have at least two chains.</p>
</div>
<div id="side-note-how-to-check-precision" class="section level4">
<h4 class="hasAnchor">
<a href="#side-note-how-to-check-precision" class="anchor"></a>Side note: How to check precision?</h4>
<p>The precision of the MCMC sample can be checked with the function <a href="https://nerler.github.io/JointAI/reference/MC_error.html"><code><a href="../reference/MC_error.html">MC_error()</a></code></a>. It calculates the Monte Carlo error (the error that is made since the sample is finite) and compares it to the standard deviation of the posterior sample. A rule of thumb is that the Monte Carlo error should not be more than 5% of the standard deviation.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
</div>
</div>
<div id="thinning" class="section level3">
<h3 class="hasAnchor">
<a href="#thinning" class="anchor"></a>Thinning</h3>
<p>In settings with high autocorrelation, i.e., there are no large jumps in the chain but sampled values are always close to the previous value, it may take many iterations before a sample is created that sufficiently represents the whole range of the posterior distribution.</p>
<p>Processing of such long chains can be slow and take a lot of memory. The parameter <code>thin</code> allows the user to specify if and how much the MCMC chains should be thinned out before storing them. By default <code>thin = 1</code> is used, which corresponds to keeping all values. A value <code>thin = 10</code> would result in keeping every 10th value and discarding all other values.</p>
</div>
<div id="examples" class="section level3">
<h3 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h3>
<div id="default-settings" class="section level4">
<h4 class="hasAnchor">
<a href="#default-settings" class="anchor"></a>Default settings</h4>
<p><code>n.adapt = 100</code> and <code>thin = 1</code> with 100 sampling iterations</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">mod1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span>(<span class="no">SBP</span> ~ <span class="no">alc</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>, <span class="kw">n.iter</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">progress.bar</span> <span class="kw">=</span> <span class="st">'none'</span>)</pre></body></html></div>
<p>The relevant part of the model summary (obtained with <a href="https://nerler.github.io/JointAI/reference/summary.JointAI.html"><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code></a>) shows that the first 100 iterations (adaptive phase) were discarded, and the 100 iterations that follow form the posterior sample. Thinning was set to 1 and there are 3 chains.</p>
<pre><code>#&gt; [...]
#&gt; 
#&gt; MCMC settings:
#&gt; Iterations = 101:200
#&gt; Sample size per chain = 100 
#&gt; Thinning interval = 1</code></pre>
</div>
<div id="insufficient-adaptation-phase" class="section level4">
<h4 class="hasAnchor">
<a href="#insufficient-adaptation-phase" class="anchor"></a>Insufficient adaptation phase</h4>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">mod2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span>(<span class="no">SBP</span> ~ <span class="no">alc</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>, <span class="kw">n.adapt</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">n.iter</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">progress.bar</span> <span class="kw">=</span> <span class="st">'none'</span>)
<span class="co">#&gt; Warning in rjags::jags.model(file = modelfile, data = data_list, inits = inits, : Adaptation</span>
<span class="co">#&gt; incomplete</span>
<span class="co">#&gt; NOTE: Stopping adaptation</span></pre></body></html></div>
<p>Specifying <code>n.adapt = 10</code> results in a warning message. The relevant part of the model summary from the resulting model is:</p>
<pre><code>#&gt; [...]
#&gt; 
#&gt; MCMC settings:
#&gt; Iterations = 11:110
#&gt; Sample size per chain = 100 
#&gt; Thinning interval = 1</code></pre>
</div>
<div id="thinning-1" class="section level4">
<h4 class="hasAnchor">
<a href="#thinning-1" class="anchor"></a>Thinning</h4>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">mod3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span>(<span class="no">SBP</span> ~ <span class="no">alc</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>, <span class="kw">n.iter</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">thin</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">progress.bar</span> <span class="kw">=</span> <span class="st">'none'</span>)</pre></body></html></div>
<p>Here, iterations 110 until 600 are used in the output, but due to thinning interval of ten, the resulting MCMC chains contain only 50 samples instead of 500, that is, the samples from iteration 110, 120, 130, …</p>
<pre><code>#&gt; [...]
#&gt; 
#&gt; MCMC settings:
#&gt; Iterations = 110:600
#&gt; Sample size per chain = 50 
#&gt; Thinning interval = 10</code></pre>
</div>
</div>
</div>
<div id="parameters-to-follow" class="section level2">
<h2 class="hasAnchor">
<a href="#parameters-to-follow" class="anchor"></a>Parameters to follow</h2>
<p>JAGS only saves the values of MCMC chains for those nodes for which the user has specified that they should be monitored. This is also the case in <strong>JointAI</strong>.</p>
<div id="what-are-nodes" class="section level3">
<h3 class="hasAnchor">
<a href="#what-are-nodes" class="anchor"></a>What are nodes?</h3>
<p>Nodes are variables in the Bayesian framework, i.e., everything observed or unobserved. This includes the data and parameters that are estimated, but also missing values in the data or parts of the data that are generally unobserved, such as random effects or latent class indicators.</p>
</div>
<div id="specifying-which-nodes-should-be-monitored" class="section level3">
<h3 class="hasAnchor">
<a href="#specifying-which-nodes-should-be-monitored" class="anchor"></a>Specifying which nodes should be monitored</h3>
<p>For this purpose, the main analysis functions <code>*_imp</code> have an argument <code>monitor_params</code>.</p>
<p>For details, explanation and examples see the vignette <a href="https://nerler.github.io/JointAI/articles/SelectingParameters.html"><em>Parameter Selection</em></a>.</p>
</div>
</div>
<div id="initial-values" class="section level2">
<h2 class="hasAnchor">
<a href="#initial-values" class="anchor"></a>Initial values</h2>
<p>Initial values are the starting point for the MCMC sampler. Setting good initial values, i.e., initial values that are likely under the posterior distribution, can speed up convergence. By default, the argument <code>inits = NULL</code>, which means that initial values for the nodes are generated by JAGS. <strong>JointAI</strong> only sets the initial values for the random number generators to allow reproducibility of the results.</p>
<p>The argument <code>seed</code> allows the specification of a seed value with which the starting values of the random number generator can be reproduced.</p>
<div id="user-specified-initial-values" class="section level3">
<h3 class="hasAnchor">
<a href="#user-specified-initial-values" class="anchor"></a>User-specified initial values</h3>
<p>It is possible to supply initial values directly as</p>
<ul>
<li>a list or</li>
<li>a function.</li>
</ul>
<p>Initial values can be specified for every unobserved node, that is, parameters and missing values, but it is possible to only specify initial values for a subset of nodes.</p>
<p>Unless the user-specified initial values contain initial values for the random number generator (named <code>.RNG.name</code> and <code>.RNG.seed</code>), <strong>JointAI</strong> will add these to the initial values. This is necessary for reproducibility of the results but also when the MCMC chains are sampled in parallel (i.e, when the argument <code>parallel = TRUE</code>).</p>
<div id="initial-values-in-a-list-of-lists" class="section level4">
<h4 class="hasAnchor">
<a href="#initial-values-in-a-list-of-lists" class="anchor"></a>Initial values in a list of lists</h4>
<p>A list containing initial values should have the same length as the number of chains, where each element is a named list of initial values. Initial values should differ between the chains.</p>
<p>For example, to create initial values for the parameter vector <code>beta</code> and the precision parameter <code>tau_SBP</code> for three chains:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">init_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fl">1</span>:<span class="fl">3</span>, <span class="kw">function</span>(<span class="no">i</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">beta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">4</span>),
       <span class="kw">tau_SBP</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>))
})

<span class="no">init_list</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [[1]]$beta</span>
<span class="co">#&gt; [1]  0.3863473 -0.9996276  0.8083691 -1.1801209</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$tau_SBP</span>
<span class="co">#&gt; [1] 0.8227471</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [[2]]$beta</span>
<span class="co">#&gt; [1] -2.040198  1.319686  1.047834 -1.087504</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$tau_SBP</span>
<span class="co">#&gt; [1] 0.3117597</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [[3]]$beta</span>
<span class="co">#&gt; [1]  0.6257895 -0.7055116  1.9311739  0.3946640</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]$tau_SBP</span>
<span class="co">#&gt; [1] 0.5337015</span></pre></body></html></div>
<p>The list is then passed to the argument <code>inits</code>. The amended version of the user provided lists of initial values are stored in the JointAI object:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">mod4a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span>(<span class="no">SBP</span> ~ <span class="no">gender</span> + <span class="no">age</span> + <span class="no">WC</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>, <span class="kw">progress.bar</span> <span class="kw">=</span> <span class="st">'none'</span>,
                <span class="kw">inits</span> <span class="kw">=</span> <span class="no">init_list</span>)

<span class="no">mod4a</span>$<span class="no">mcmc_settings</span>$<span class="no">inits</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [[1]]$beta</span>
<span class="co">#&gt; [1]  0.3863473 -0.9996276  0.8083691 -1.1801209</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$tau_SBP</span>
<span class="co">#&gt; [1] 0.8227471</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$.RNG.name</span>
<span class="co">#&gt; [1] "base::Super-Duper"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$.RNG.seed</span>
<span class="co">#&gt; [1] 571</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [[2]]$beta</span>
<span class="co">#&gt; [1] -2.040198  1.319686  1.047834 -1.087504</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$tau_SBP</span>
<span class="co">#&gt; [1] 0.3117597</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$.RNG.name</span>
<span class="co">#&gt; [1] "base::Marsaglia-Multicarry"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$.RNG.seed</span>
<span class="co">#&gt; [1] 25096</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [[3]]$beta</span>
<span class="co">#&gt; [1]  0.6257895 -0.7055116  1.9311739  0.3946640</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]$tau_SBP</span>
<span class="co">#&gt; [1] 0.5337015</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]$.RNG.name</span>
<span class="co">#&gt; [1] "base::Marsaglia-Multicarry"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]$.RNG.seed</span>
<span class="co">#&gt; [1] 63823</span></pre></body></html></div>
</div>
<div id="initial-values-as-a-function" class="section level4">
<h4 class="hasAnchor">
<a href="#initial-values-as-a-function" class="anchor"></a>Initial values as a function</h4>
<p>Initial values can be specified by a function. The function should either take no arguments or a single argument called <code>chain</code>, and return a named list that supplies values for one chain.</p>
<p>For example, to create initial values for the parameter vectors <code>beta</code> and <code>alpha</code>:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">inits_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">beta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">4</span>),
       <span class="kw">alpha</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">3</span>))
}

<span class="fu">inits_fun</span>()
<span class="co">#&gt; $beta</span>
<span class="co">#&gt; [1]  0.6483785  0.6838959 -0.2172458 -1.3875379</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $alpha</span>
<span class="co">#&gt; [1] -0.4055412 -0.8518768 -0.1000739</span>


<span class="no">mod4b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lm_imp</a></span>(<span class="no">SBP</span> ~ <span class="no">gender</span> + <span class="no">age</span> + <span class="no">WC</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">NHANES</span>, <span class="kw">progress.bar</span> <span class="kw">=</span> <span class="st">'none'</span>,
                <span class="kw">inits</span> <span class="kw">=</span> <span class="no">inits_fun</span>)

<span class="no">mod4b</span>$<span class="no">mcmc_settings</span>$<span class="no">inits</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [[1]]$beta</span>
<span class="co">#&gt; [1] -0.8698509 -0.9446212  2.1186361 -0.7957608</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$alpha</span>
<span class="co">#&gt; [1]  0.9782984 -1.0481347 -1.4686892</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$.RNG.name</span>
<span class="co">#&gt; [1] "base::Mersenne-Twister"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$.RNG.seed</span>
<span class="co">#&gt; [1] 28962</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [[2]]$beta</span>
<span class="co">#&gt; [1]  0.09241416  1.57220854 -0.81779726  0.71991964</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$alpha</span>
<span class="co">#&gt; [1] -0.08453865 -0.99171837 -0.08196836</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$.RNG.name</span>
<span class="co">#&gt; [1] "base::Marsaglia-Multicarry"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$.RNG.seed</span>
<span class="co">#&gt; [1] 59752</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [[3]]$beta</span>
<span class="co">#&gt; [1] -1.4124494 -0.6126601  0.1435951 -0.6682401</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]$alpha</span>
<span class="co">#&gt; [1] -0.4790079 -0.8817024  0.0722309</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]$.RNG.name</span>
<span class="co">#&gt; [1] "base::Marsaglia-Multicarry"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]$.RNG.seed</span>
<span class="co">#&gt; [1] 25636</span></pre></body></html></div>
<p>When a function is supplied, the function will be evaluated once per chain and the resulting list is stored.</p>
</div>
</div>
<div id="for-which-nodes-can-initial-values-be-specified" class="section level3">
<h3 class="hasAnchor">
<a href="#for-which-nodes-can-initial-values-be-specified" class="anchor"></a>For which nodes can initial values be specified?</h3>
<p>Initial values can be specified for all unobserved stochastic nodes, i.e., parameters or unobserved data for which a distribution is specified in the JAGS model.</p>
<p>Initial values have to be supplied in the format the parameter or unobserved value is used in the JAGS model.</p>
<p>To find out which nodes there are in a model, the function <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> from package <strong>rjags</strong> can be used on a JAGS model object. It returns a list with the current values of the MCMC chains, by default the first chain. Elements of the initial values should have the same structure as the elements in this list.</p>
<p><strong>Example:<br></strong> We are using a longitudinal model and the <code>simLong</code> data in this example. The output is abbreviated to show the relevant characteristics.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">mod4c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_imp.html">lme_imp</a></span>(<span class="no">bmi</span> ~ <span class="no">time</span> + <span class="no">HEIGHT_M</span> + <span class="no">hc</span> + <span class="no">SMOKE</span>, <span class="kw">random</span> <span class="kw">=</span> ~ <span class="no">time</span> <span class="kw">|</span> <span class="no">ID</span>,
                 <span class="kw">data</span> <span class="kw">=</span> <span class="no">simLong</span>, <span class="kw">no_model</span> <span class="kw">=</span> <span class="st">'time'</span>, <span class="kw">progress.bar</span> <span class="kw">=</span> <span class="st">'none'</span>)

<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">mod4c</span>$<span class="no">model</span>)</pre></body></html></div>
<pre><code>#&gt; Warning: 
#&gt; It is currently not possible to use "contr.poly" for incomplete categorical covariates.
#&gt; I will use "contr.treatment" instead.  You can specify (globally) which types of
#&gt; contrasts are used by changing "options('contrasts')".
#&gt; $M_ID
#&gt;        [,1]     [,2] [,3] [,4] [,5]
#&gt;   [1,]   NA       NA   NA   NA   NA
#&gt;   [2,]   NA       NA   NA   NA   NA
#&gt;   [3,]   NA       NA   NA   NA   NA
#&gt;   [4,]   NA       NA   NA   NA   NA
#&gt;   [5,]   NA       NA   NA   NA   NA
#&gt;   [6,]    1       NA   NA   NA   NA
#&gt;   [7,]   NA       NA   NA   NA   NA
#&gt;   [8,]   NA       NA   NA   NA   NA
#&gt;   [9,]   NA       NA   NA   NA   NA
#&gt;  [10,]   NA       NA   NA   NA   NA
#&gt;  [11,]   NA       NA   NA   NA   NA
#&gt;  [12,]   NA       NA   NA   NA   NA
#&gt; 
#&gt; [...]
#&gt; 
#&gt;  [92,]   NA       NA   NA   NA   NA
#&gt;  [93,]   NA       NA   NA   NA   NA
#&gt;  [94,]   NA       NA   NA   NA   NA
#&gt; 
#&gt; [...]
#&gt; 
#&gt;    [6,]   NA       NA   NA
#&gt;    [7,]   NA 45.01624   NA
#&gt;    [8,]   NA       NA   NA
#&gt;    [9,]   NA       NA   NA
#&gt;   [10,]   NA       NA   NA
#&gt;   [11,]   NA       NA   NA
#&gt;   [12,]   NA       NA   NA
#&gt; 
#&gt; [...]
#&gt; 
#&gt;  [149,]   NA       NA   NA
#&gt;  [150,]   NA       NA   NA
#&gt;  [151,]   NA       NA   NA
#&gt;  [152,]   NA       NA   NA
#&gt;  [153,]   NA       NA   NA
#&gt; 
#&gt; [...]
#&gt; 
#&gt;  [209,]    0       NA   NA
#&gt;  [210,]   NA       NA   NA
#&gt;  [211,]   NA       NA   NA
#&gt;  [212,]   NA       NA   NA
#&gt;  [213,]   NA 45.33154   NA
#&gt;  [214,]   NA       NA   NA
#&gt;  [215,]    0       NA   NA
#&gt;  [216,]    0       NA   NA
#&gt;  [217,]   NA       NA   NA
#&gt;  [218,]   NA 42.90560   NA
#&gt;  [219,]    0  0.00000   NA
#&gt;  [220,]   NA       NA   NA
#&gt; 
#&gt; [...]
#&gt; 
#&gt; 
#&gt; $b_hc_ID
#&gt;            [,1]
#&gt;   [1,] 40.37277
#&gt;   [2,] 41.59689
#&gt;   [3,] 45.40098
#&gt;   [4,] 46.65607
#&gt;   [5,] 42.35812
#&gt;   [6,] 41.47581
#&gt;   [7,] 41.24233
#&gt; 
#&gt; [...]
#&gt; 
#&gt; $delta_SMOKE
#&gt; [1] -1.204691
#&gt; 
#&gt; $gamma_SMOKE
#&gt; [1] 1.27162      NA
#&gt; 
#&gt; 
#&gt; [...]
#&gt; 
#&gt; [186,]   NA -0.03679006
#&gt; [187,]   NA -0.03679006
#&gt; [188,]   NA -0.03679006
#&gt; [189,]   NA -0.03679006
#&gt; [190,]   NA -0.03679006
#&gt; [191,]   NA -0.03679006
#&gt; [192,]   NA -0.03679006
#&gt; [193,]   NA -0.03679006
#&gt; 
#&gt; [...]
#&gt; 
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; 
#&gt; [...]
#&gt; 
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; 
#&gt; [...]
#&gt; 
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA
#&gt; NA</code></pre>
<p><code>RinvD</code> is the scale matrix in the Wishart prior for the inverse of the random effects design matrix <code>D</code>. In the data that is passed JAGS (which is stored in the element <code>data_list</code> in a JointAI object), this matrix is specified as diagonal matrix, with unknown diagonal elements:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">mod4c</span>$<span class="no">data_list</span>[<span class="st">'RinvD'</span>]
<span class="co">#&gt; $&lt;NA&gt;</span>
<span class="co">#&gt; NULL</span></pre></body></html></div>
<p>These diagonal elements are estimated in the model and have a Gamma prior. The corresponding part of the JAGS model is:</p>
<pre><code>#&gt; [...]
#&gt;   tau_bmi ~ dgamma(shape_tau_norm, rate_tau_norm)
#&gt;   sigma_bmi &lt;- sqrt(1/tau_bmi)
#&gt; 
#&gt;   for (k in 1:2) {
#&gt;     RinvD_bmi_ID[k, k] ~ dgamma(shape_diag_RinvD, rate_diag_RinvD)
#&gt;   }
#&gt; [...]</code></pre>
<p>The element <code>RinvD</code> in the initial values has to be a 2 <span class="math inline">\(\times\)</span> 2 matrix, with positive values on the diagonal and <code>NA</code> as off-diagonal elements, since these are fixed in the data.</p>
<p>The following element in the output of <code><a href="https://rdrr.io/r/stats/coef.html">coef(mod4c$model)</a></code> is <code>Xc</code>, the fixed effects design matrix containing baseline covariates. The corresponding matrix in the data is</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">mod4c</span>$<span class="no">data_list</span>$<span class="no">M_ID</span>[<span class="fl">81</span>:<span class="fl">85</span>, ]</pre></body></html></div>
<pre><code>#&gt;       SMOKE HEIGHT_M (Intercept) SMOKEsmoked until[...] SMOKEcontin[...]
#&gt; 171.1     1 170.7984           1                     NA               NA
#&gt; 172.1     1 169.6309           1                     NA               NA
#&gt; 173.1     1       NA           1                     NA               NA
#&gt; 174.1     1 172.4946           1                     NA               NA
#&gt; 175.1     1 182.6187           1                     NA               NA</code></pre>
<p>Again, the matrix <code>Xc</code> in the initial values has the same dimension as <code>Xc</code> in the data, and values where there are missing values in <code>Xc</code>, e.g., <code>Xc[83, 2]</code> and <code>NA</code> elsewhere. There are no initial values specified for the third and fourth column, since these columns contain the dummy variables corresponding to the categorical variable <code>SMOKE</code> and are calculated from a column in the matrix <code>Xcat</code>, which contains the original version of <code>SMOKE</code>:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">mod4c</span>$<span class="no">data_list</span>$<span class="no">M_ID</span>)
<span class="co">#&gt;       SMOKE HEIGHT_M (Intercept) SMOKEsmoked until pregnancy was known</span>
<span class="co">#&gt; 1.1       1 172.2782           1                                    NA</span>
<span class="co">#&gt; 10.1      1 170.5049           1                                    NA</span>
<span class="co">#&gt; 100.1     3 170.0612           1                                    NA</span>
<span class="co">#&gt; 101.1     1 161.7947           1                                    NA</span>
<span class="co">#&gt; 102.1     1 175.9738           1                                    NA</span>
<span class="co">#&gt; 103.1    NA 163.9138           1                                    NA</span>
<span class="co">#&gt;       SMOKEcontinued smoking in pregnancy</span>
<span class="co">#&gt; 1.1                                    NA</span>
<span class="co">#&gt; 10.1                                   NA</span>
<span class="co">#&gt; 100.1                                  NA</span>
<span class="co">#&gt; 101.1                                  NA</span>
<span class="co">#&gt; 102.1                                  NA</span>
<span class="co">#&gt; 103.1                                  NA</span></pre></body></html></div>
<p>The relevant part of the JAGS model is:</p>
<pre><code>#&gt; [...]
#&gt;   # Priors for the model for hc
#&gt;   for (k in 1:5) {
#&gt; 
#&gt; [...]
#&gt; 
#&gt; 
#&gt;   # Cumulative logit model for SMOKE ----------------------------------------------
#&gt; [...]</code></pre>
<p>Where <code>Xcat</code> in the data has missing values (e.g., rows 37 and 39), initial values need to be specified.</p>
<p>Elements that are completely unobserved, like the parameter vectors <code>alpha</code> and <code>beta</code>, the random effects <code>b</code> or scalar parameters <code>delta_SMOKE</code> and <code>gamma_SMOKE</code> are entirely specified in the initial values.</p>
</div>
</div>
<div id="parallel-sampling" class="section level2">
<h2 class="hasAnchor">
<a href="#parallel-sampling" class="anchor"></a>Parallel sampling</h2>
<p>To reduce computational time, it is possible to perform sampling of multiple MCMC chains in parallel on multiple cores. This can be specified by setting the argument <code>parallel = TRUE</code>. The maximum number of cores to be used can be set with the argument <code>n.cores</code>. By default, this is two less than the number of cores available on the machine, but never more than the number of MCMC chains.</p>
<p>Parallel computation is done using the R packages <a href="https://CRAN.R-project.org/package=foreach"><strong>foreach</strong></a> and <a href="https://CRAN.R-project.org/package=doParallel"><strong>doParallel</strong></a>. Unfortunately, currently it is not possible to obtain a progress bar when using parallel computation and warning messages produced during the sampling are not returned.</p>
</div>
<div id="other-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#other-arguments" class="anchor"></a>Other arguments</h2>
<p>There are two more arguments in <code>*_imp()</code> that are passed directly to the <strong>rjags</strong> functions <code>jags.model()</code> or <code>coda.samples()</code>:</p>
<ul>
<li>
<code>quiet</code>: should messages generated during compilation be suppressed?</li>
<li>
<code>progress.bar</code>: allows to select the type of progress bar. Possible values are <code>"text"</code>, <code>"gui"</code> and <code>"none"</code>.</li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p> Gelman, A., Meng, X. L., &amp; Stern, H. (1996). Posterior predictive assessment of model fitness via realized discrepancies. Statistica Sinica, 733-760.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>See p. 195 of Lesaffre, E., &amp; Lawson, A. B. (2012). Bayesian Biostatistics. John Wiley &amp; Sons.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicole S. Erler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '0d21d69e7c3eb00e029f5b8d9424cd56',
    indexName: 'jointal',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
